!function(g){g.su.moduleManager.define("mapRouter",{services:["device","timer","ajax"],models:["statusAll","deviceNameModel","wireless24gNetworkMap","wireless5g1NetworkMap","wireless5g2NetworkMap","guest24gNetworkMap","guest5g1NetworkMap","guest5g2NetworkMap"],stores:["ethernetStatusStore"],deps:["navigatorController","networkMap"],views:["mapRouterView"],listeners:{"ev_on_launch":function(e,t,a,o,s,n,r){this.unRegisterAutoSaveData([o.statusAll,o.deviceNameModel,o.wireless24gNetworkMap,o.wireless5g1NetworkMap,o.wireless5g2NetworkMap,o.guest24gNetworkMap,o.guest5g1NetworkMap,o.guest5g2NetworkMap]),a.mapRouterView.cpuLoad.setOption(t.calculateLineOption({title:g.su.CHAR.NETWORK_MAP.CPU_LOAD,color:"#ffcd08",tooltip:{backgroundColor:"rgba(255, 203, 0, 0.8)"},name:g.su.CHAR.NETWORK_MAP.CPU_CORE_NUMBER+":"})),a.mapRouterView.memoryUsage.setOption(t.calculateLineOption({title:g.su.CHAR.NETWORK_MAP.MEMORY_USAGE,color:"#53C5D2",tooltip:{backgroundColor:"rgba(74, 203, 214, 0.8)"},areaColor:"rgba(83, 197, 210, 0.5)"})),o.deviceNameModel.load(),o.wireless24gNetworkMap.load(),o.wireless5g1NetworkMap.load(),o.guest24gNetworkMap.load(),o.guest5g1NetworkMap.load(),r.device.getIsTriband()?(a.mapRouterView.wireless5g2Fieldset.show(),a.mapRouterView.guest5g2Fieldset.show(),o.wireless5g2NetworkMap.load(),o.guest5g2NetworkMap.load()):(a.mapRouterView.wireless5g2Fieldset.hide(),a.mapRouterView.guest5g2Fieldset.hide(),o.wireless5g1NetworkMap.enable.setLabelField(g.su.CHAR.NETWORK_MAP.WIRELESS_5GHZ),o.guest5g1NetworkMap.enable.setLabelField(g.su.CHAR.NETWORK_MAP.WIRELESS_5GHZ)),!0===r.device.getConfig().supportSelectPort?(t.initBind(),"router"===r.device.getCurrentMode()?t.getWanStatus(function(e){s.ethernetStatusStore.dataObj.convert=t.wanConvert.bind(null,e),s.ethernetStatusStore.load()}):(s.ethernetStatusStore.dataObj.convert=t.wanConvert.bind(null,1),s.ethernetStatusStore.load())):s.ethernetStatusStore.load(),r.timer.setInterval(t,function(){0<t.delayInterval||(t.delayInterval=1,o.statusAll.load({success:function(e){t.delayInterval=0;e=o.statusAll.getData();n.networkMap.handleWirelessIcon(e),t.setWirelessEnable(e)},fail:function(){t.delayInterval=0},error:function(){t.delayInterval=0}}))},20101,!0)}},init:function(a,o,s,e,n,t){this.control({"#map-router-wireless-button":{"ev_button_click":function(e){n.navigatorController.goTo("wirelessSettingsAdv")}},"#map-router-guest-button":{"ev_button_click":function(e){n.navigatorController.goTo("guestNetworkAdv")}},"#map-router-usb-button":{"ev_button_click":function(e){n.navigatorController.goTo("storageSharing")}},"#device-name-edit-btn":{"ev_button_click":function(e){o.mapRouterView.deviceNameMsg.show()}},"#device-name-msg-submit-btn":{"ev_button_click":function(){var e=s.deviceNameModel;e.validate()&&(e.submit({success:function(e){o.mapRouterView.deviceName.setValue(e.model)}}),o.mapRouterView.deviceNameMsg.hide())}},"#device-name-msg-cancel-btn":{"ev_button_click":function(){o.mapRouterView.deviceNameMsg.hide()}},"#wireless2g-enable-switch":{"ev_view_change":function(e,t){s.wireless24gNetworkMap.submit({data:{disabled_all:"on"==t.value?"off":"on"},success:function(e){n.networkMap.handleWirelessIcon(e.enable,"2g"),"off"==e.enable?s.guest24gNetworkMap.enable.disable():s.guest24gNetworkMap.enable.enable()}})}},"#wireless5g-enable-switch":{"ev_view_change":function(e,t){s.wireless5g1NetworkMap.submit({data:{disabled_all:"on"==t.value?"off":"on"},success:function(e){n.networkMap.handleWirelessIcon(e.enable,"5g"),"off"==e.enable?s.guest5g1NetworkMap.enable.disable():s.guest5g1NetworkMap.enable.enable()}})}},"#wireless5g2-enable-switch":{"ev_view_change":function(e,t){s.wireless5g2NetworkMap.submit({data:{disabled_all:"on"==t.value?"off":"on"},success:function(e){n.networkMap.handleWirelessIcon(e.enable,"5g-2"),"off"==e.enable?s.guest5g2NetworkMap.enable.disable():s.guest5g2NetworkMap.enable.enable()}})}},"#guestNetwork2g-enable-switch":{"ev_view_change":function(){s.guest24gNetworkMap.submit()}},"#guestNetwork5g-enable-switch":{"ev_view_change":function(){s.guest5g1NetworkMap.submit()}},"#guestNetwork5g2-enable-switch":{"ev_view_change":function(){s.guest5g2NetworkMap.submit()}}}),this.listen({"models.statusAll":{"ev_loaded":function(e,t){a.setStorage(t),a.setWirelessStatus(t),a.setPerformance(t)}},"models.deviceNameModel":{"ev_loaded":function(e,t){o.mapRouterView.deviceName.setValue(t.model),n.networkMap.setProductName(t.model)}},"models.wireless24gNetworkMap":{"ev_loaded":function(e,t){"off"==t.enable?s.guest24gNetworkMap.enable.disable():s.guest24gNetworkMap.enable.enable()}},"models.wireless5g1NetworkMap":{"ev_loaded":function(e,t){"off"==t.enable?s.guest5g1NetworkMap.enable.disable():s.guest5g1NetworkMap.enable.enable()}},"models.wireless5g2NetworkMap":{"ev_loaded":function(e,t){"off"==t.enable?s.guest5g2NetworkMap.enable.disable():s.guest5g2NetworkMap.enable.enable()}}})}},function(e,n,s,t,a,o){var r=0,l=function(){for(var e=[],t=7;t--;)e.push(0);return e}(),i=function(){for(var e=[],t=7;t--;)e.push(0);return e}(),u=function(e,t){e=e||2e3,t=t||7;for(var a=new Date,o=[];t--;)o.unshift(s(a)),a=new Date(a-e);function s(e){var t="";return t+=("0"+e.getHours()).slice(-2),t+=":",t+=("0"+e.getMinutes()).slice(-2),t+=":",t+=("0"+e.getSeconds()).slice(-2)}return o};return{delayInterval:0,initBind:function(){Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),a=this,o=function(){},s=function(){return a.apply(this instanceof o&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,s.prototype=new o,s})},wanConvert:function(s,e){return g.map(e,function(e){var t={serial:""},a=["wan",g.su.CHAR.NETWORK_MAP.PORT_2500LAN,g.su.CHAR.NETWORK_MAP.PORT_1000LAN];for(key in e){if(!t.serial&&/\d/.test(key)){var o=/\d/.exec(key)[0];/lan/.test(key)?(t.serial=o,t.type="lan"):/wan/.test(key)&&(o=parseInt(o),t.type=s===o?a[0]:a[o])}/status/.test(key)&&(t.status=e[key]),/speed/.test(key)&&(t.speed=e[key]),/duplex/.test(key)&&(t.duplex=e[key])}return t})},getWanStatus:function(t){o.ajax.request({proxy:"wanStatusProxy",success:function(e){r="1000WAN"===e.wan_port_status?2:1,t&&t(r)},fail:function(){r=0,t&&t(r)},error:function(){r=0,t&&t(r)}})},setWirelessEnable:function(e){s.wireless24gNetworkMap.enable.setValue(e.wireless2gEnable),s.wireless5g1NetworkMap.enable.setValue(e.wireless5gEnable),s.guest24gNetworkMap.enable.setValue(e.guest2gEnable),s.guest5g1NetworkMap.enable.setValue(e.guest5gEnable),o.device.getIsTriband()&&(s.wireless5g2NetworkMap.enable.setValue(e.wireless5g2Enable),s.guest5g2NetworkMap.enable.setValue(e.guest5g2Enable))},setWirelessStatus:function(e){var t=e.wireless2gEncryption,a=e.wireless5gEncryption,o=e.wireless5g2Encryption;"none"==t?s.statusAll.wireless2gPassword.hide():s.statusAll.wireless2gPassword.show(),"none"==a?s.statusAll.wireless5gPassword.hide():s.statusAll.wireless5gPassword.show(),"none"==o?s.statusAll.wireless5g2Password.hide():s.statusAll.wireless5g2Password.show(),"none"==e.guest2g5gEncryption?s.statusAll.guest2g5gPskKey.hide():s.statusAll.guest2g5gPskKey.show()},setStorage:function(e){var t={PB:g.su.CHAR.UNIT.PB,TB:g.su.CHAR.UNIT.TB,GB:g.su.CHAR.UNIT.GB,MB:g.su.CHAR.UNIT.MB,KB:g.su.CHAR.UNIT.KB,B:g.su.CHAR.UNIT.B};function a(e){return e&&e.toUpperCase()}var o=g.su.capacityToNum(e.storageAvailable+t[a(e.storageAvailableUnit)]),s=g.su.capacityToNum(e.storageCapacity+t[a(e.storageCapacityUnit)]);n.mapRouterView.usbCapacityRate.setValue(o/s*100)},setPerformance:function(e){var t=e.cpuUsage,a=e.memUsage,o=u(2e3,7);l.shift(),l.push(t),n.mapRouterView.cpuLoad.setOption({xAxis:[{data:o}],series:{data:l}}),i.shift(),i.push(a),n.mapRouterView.memoryUsage.setOption({xAxis:[{data:o}],series:{data:i}})},calculateLineOption:function(r){return{title:{show:!1,text:(r=g.extend({title:"",color:"#ffcd08",name:"",areaColor:"rgba(255, 205, 8, 0.5)"},r)).title,textStyle:{fontSize:13},left:20},grid:{top:10,right:0,left:40,bottom:10},tooltip:g.extend({show:!0,formatter:"{c}%",textStyle:{color:"#000000",fontSize:12,lineHeight:14,fontFamily:"Arial, Sans-Serif, Geneva, Verdana"},padding:[2.6,6],position:function(e,t,a,o,s){var n="";return n+="<span>"+t.value+"%</span>",n+='<span style="display:block;position:absolute;left:'+(s.contentSize[0]/2-3+"px")+";bottom:-6px;border-top:6px solid "+r.tooltip.backgroundColor+';border-left:3px solid transparent;border-right:3px solid transparent;border-bottom:none;background-color:transparent;width:0;height:0;line-height:14px;"></span>',g(a).html(n),[e[0]-18.5,e[1]-40]}},r.tooltip),xAxis:[{name:r.name,nameLocation:"middle",nameTextStyle:{color:"#000"},type:"category",axisLine:{show:!1},axisLabel:{show:!1},axisTick:{show:!1},boundaryGap:!1,data:u(2e3,7)}],yAxis:[{max:100,min:0,interval:20,nameTextStyle:{color:"#005564"},type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dashed"}},axisLabel:{show:!0,align:"left",textStyle:{color:"rgba(255,255,255,0.8)",fontSize:12},formatter:function(e,t){return e+"%"}}}],series:[{name:"RX",type:"line",smooth:!0,symbol:"emptyCircle",symbolSize:6,showAllSymbol:!0,legendHoverLink:!1,itemStyle:{normal:{color:r.color,borderColor:r.color}},areaStyle:{normal:{color:{x:0,y:0,x2:0,y2:1,type:"linear",globalCoord:!1,colorStops:[{offset:0,color:r.areaColor},{offset:1,color:"rgba(255, 255, 255, 0.5)"}]}}},lineStyle:{width:1},data:r.data}]}}}})}(jQuery);
jQuery.su.moduleManager.define("iptvAdv",{services:["moduleLoader","moduleManager"],models:["iptvVlan"],stores:[],deps:["iptvVlanAdv"],views:["iptvAdvView"],listeners:{ev_on_launch:function(e,i,a,n,t,l,p){p.moduleLoader.load({module:"iptvAdv"},{module:"iptvVlanAdv",view:"iptvVlanView"},a.iptvAdvView.iptvVlanLoader,function(){p.moduleLoader.load({module:"iptvAdv"},{module:"iptvMultiAdv"},a.iptvAdvView.iptvMultiLoader,function(){var e=p.moduleManager.get("iptvVlanAdv");e.setMode(e.MODE.ADVANCED),e.startup()})})}},init:function(e,a,n,i,t,l){this.configViews({id:"iptvAdvView",items:[{id:"iptv-vlan-loader"},{id:"iptv-multi-loader"}]}),this.control({".index-common-save-btn":{"ev_will_auto_save":function(e,i){i.preventDefault(),n.iptvVlan.validate()&&t.iptvVlanAdv.atLeastOne()&&t.iptvVlanAdv.vidSame()&&n.iptvVlan.submit({success:function(e){e.cfg_changed&&a.iptvAdvView.iptvRebootMsg.show(function(){a.iptvAdvView.iptvRebootProgress.animate({duration:15e3,percentageStart:0,percentageEnd:100,callback:function(){a.iptvAdvView.iptvRebootMsg.hide()}})})}})}}}),this.listen()}},function(e,i,a,n,t,l){return{}}),$.su.modelManager.define("iptvVlan",{type:"model",fields:[{name:"enable"},{name:"mode"},{name:"internetVid",mapping:"internet_vid",allowBlank:!1,vtype:{vtype:"number",min:2,max:4094,minMaxText:$.su.CHAR.NETWORK_IPTV.VALUE_TIPS},serialize:function(e){return Number(e)}},{name:"internetVprio",mapping:"internet_vprio"},{name:"internetTag",mapping:"internet_tag"},{name:"ipphoneVid",mapping:"ipphone_vid",allowBlank:!1,vtype:{vtype:"number",min:2,max:4094,minMaxText:$.su.CHAR.NETWORK_IPTV.VALUE_TIPS},serialize:function(e){return Number(e)}},{name:"ipphoneVprio",mapping:"ipphone_vprio"},{name:"iptvVid",mapping:"iptv_vid",allowBlank:!1,vtype:{vtype:"number",min:2,max:4094,minMaxText:$.su.CHAR.NETWORK_IPTV.VALUE_TIPS},serialize:function(e){return Number(e)}},{name:"iptvVprio",mapping:"iptv_vprio"},{name:"mciptvVid",mapping:"mciptv_vid",allowBlank:!1,vtype:{vtype:"number",min:2,max:4094,minMaxText:$.su.CHAR.NETWORK_IPTV.VALUE_TIPS},serialize:function(e){return Number(e)}},{name:"mciptvVprio",mapping:"mciptv_vprio"},{name:"mciptvEnable",mapping:"mciptv_enable"},{name:"cfg_changed"},{name:"igmp_enable"},{name:"igmp_snooping_enable",defaultValue:"on"},{name:"mcwifi_enable"},{name:"igmp_version"},{name:"qos_iptv_compatible"},{name:"wait_time"},{name:"configure"},{name:"internetItem",mapping:"internet_item"},{name:"iptvItem",mapping:"iptv_item"},{name:"ipphoneItem",mapping:"ipphone_item"},{name:"mciptvItem",mapping:"mciptv_item"},{name:"ports"},{name:"porttype"},{name:"seltype"}],proxy:{url:$.su.url("/admin/iptv?form=setting")}}),jQuery.su.moduleManager.define("iptvMultiAdv",{deps:[],services:["device"],models:["iptvVlan"],stores:["iptvVersionStore"],views:["iptvMultiView"],listeners:{ev_on_launch:function(e,i,a,n,t,l,p){p.device.getConfig().supportMulticastForwarding?(n.iptvVlan.mcwifi_enable.enable(),n.iptvVlan.mcwifi_enable.show()):(n.iptvVlan.mcwifi_enable.hide(),n.iptvVlan.mcwifi_enable.disable())}},init:function(e,i,a,n,t,l){this.control(),this.listen()}},function(e,i,a,n,t,l){return{}}),jQuery,$.su.storeManager.define("iptvVersionStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}],data:[{name:$.su.CHAR.NETWORK_IPTV.V_2,value:"2",boxlabel:"version2"},{name:$.su.CHAR.NETWORK_IPTV.V_3,value:"3",boxlabel:"version3"}]}),function(r){r.su.moduleManager.define("iptvVlanAdv",{deps:["navigatorController","quickSetup"],services:["device","moduleManager","ajax"],models:["iptvVlan","lanAdvLinkAggModel","quickSetupModel","qsSummaryModel","iptvPortModel"],stores:["modeStore","lanStore","lanTagStore","lanPriorityStore","iptvVlanStore"],views:["iptvVlanView"],listeners:{ev_on_launch:function(e,i,a,n,t,l,p){}},init:function(o,V,v,e,a,n){this.control({"#iptv-vlan-msg":{"ev_msg_ok":function(e,i){o.getMode()==o.MODE.ADVANCED&&setTimeout(function(){a.navigatorController.goTo("lanAdv")},300)},"ev_msg_cancel":function(e,i){o.getMode()==o.MODE.ADVANCED&&v.iptvVlan.mode.setValue("")}},"#iptvLan1":{"ev_view_change":function(e,i,a){var n=V.iptvVlanView.lan1.getValue(),t=V.iptvVlanView.lan2.getValue(),l=V.iptvVlanView.lan3.getValue(),p=V.iptvVlanView.lan4.getValue();v.iptvVlan.porttype.setValue([n,t,l,p].join(" "))}},"#iptvLan2":{"ev_view_change":function(e,i,a){var n=V.iptvVlanView.lan1.getValue(),t=V.iptvVlanView.lan2.getValue(),l=V.iptvVlanView.lan3.getValue(),p=V.iptvVlanView.lan4.getValue();v.iptvVlan.porttype.setValue([n,t,l,p].join(" "))}},"#iptvLan3":{"ev_view_change":function(e,i,a){var n=V.iptvVlanView.lan1.getValue(),t=V.iptvVlanView.lan2.getValue(),l=V.iptvVlanView.lan3.getValue(),p=V.iptvVlanView.lan4.getValue();v.iptvVlan.porttype.setValue([n,t,l,p].join(" "))}},"#iptvLan4":{"ev_view_change":function(e,i,a){var n=V.iptvVlanView.lan1.getValue(),t=V.iptvVlanView.lan2.getValue(),l=V.iptvVlanView.lan3.getValue(),p=V.iptvVlanView.lan4.getValue();v.iptvVlan.porttype.setValue([n,t,l,p].join(" "))}}}),n.device.getLanAgg()&&v.lanAdvLinkAggModel.load(),this.listen({"models.quickSetupModel.wanPortStatus":{"ev_value_change":function(e,i,a){o.getMode()===o.MODE.QUICK_SETUP&&V.iptvVlanView["lan4"].setLabelField("1000WAN"===i?r.su.CHAR.NETWORK_MAP.PORT_2500LAN:r.su.CHAR.NETWORK_MAP.PORT_1000LAN)}},"models.iptvVlan.enable":{"ev_value_change":function(e,i,a){v.iptvVlan.mode.hide(),V.iptvVlanView.iptvConfigWrap.hide(),"on"==i||o.getMode()===o.MODE.QUICK_SETUP?(v.iptvVlan.mode.show(),v.iptvVlan.mode.setValue(v.iptvVlan.mode.getValue()),V.iptvVlanView.iptvConfigWrap.show()):(v.iptvVlan.mode.hide(),V.iptvVlanView.iptvConfigWrap.hide())}},"models.iptvVlan.mode":{"ev_value_change":function(e,i,a){if("none"==i)return V.iptvVlanView.internetVlan.hide(),V.iptvVlanView.voipVlan.hide(),V.iptvVlanView.iptvVlanV.hide(),V.iptvVlanView.mciptvVlan.hide(),void V.iptvVlanView.allVlan.hide();i!=a&&n.ajax.request({proxy:"iptvProxy",data:{operation:"change",isp:i},success:function(e){v.iptvVlan.replaceData({"configure":e.configure,"internetItem":e.internet_item,"internetTag":e.internet_tag,"internetVid":e.internet_vid,"internetVprio":e.internet_vprio,"ipphoneItem":e.ipphone_item,"ipphoneVid":e.ipphone_vid,"ipphoneVprio":e.ipphone_vprio,"iptvItem":e.iptv_item,"iptvVid":e.iptv_vid,"iptvVprio":e.iptv_vprio,"mciptvEnable":e.mciptv_enable,"mciptvItem":e.mciptv_item,"mciptvVid":e.mciptv_vid,"mciptvVprio":e.mciptv_vprio,"ports":e.ports,"porttype":e.porttype,"seltype":e.seltype})}})}},"models.iptvVlan.mciptvEnable":{"ev_value_change":function(e,i,a){"on"==i?(v.iptvVlan.mciptvVid.enable(),v.iptvVlan.mciptvVprio.enable()):(v.iptvVlan.mciptvVid.disable(),v.iptvVlan.mciptvVprio.disable())}},"models.iptvVlan":{"ev_loaded":function(e,i){if(o.isRunning()){V.iptvVlanView.internetVlan.hide(),V.iptvVlanView.voipVlan.hide(),V.iptvVlanView.iptvVlanV.hide(),V.iptvVlanView.mciptvVlan.hide(),V.iptvVlanView.allVlan.show();var a=i,n="on"==a.configure&&o.isEditable()?"enable":"disable";if("on"==a["internetItem"]?(V.iptvVlanView.internetVlan.show(),v.iptvVlan.internetVid.setValue(a["internetVid"]),v.iptvVlan.internetVprio.setValue(a["internetVprio"]),v.iptvVlan.internetTag.setValue(a["internetTag"]),"enable"==n?(v.iptvVlan.internetVid.enable(),v.iptvVlan.internetVprio.enable(),v.iptvVlan.internetTag.enable()):(v.iptvVlan.internetVid.disable(),v.iptvVlan.internetVprio.disable(),v.iptvVlan.internetTag.disable())):V.iptvVlanView.internetVlan.hide(),"on"==a["iptvItem"]&&(V.iptvVlanView.iptvVlanV.show(),v.iptvVlan.iptvVid.setValue(a["iptvVid"]),v.iptvVlan.iptvVprio.setValue(a["iptvVprio"]),"enable"==n?(v.iptvVlan.iptvVid.enable(),v.iptvVlan.iptvVprio.enable()):(v.iptvVlan.iptvVid.disable(),v.iptvVlan.iptvVprio.disable())),"on"==a["ipphoneItem"]&&(V.iptvVlanView.voipVlan.show(),v.iptvVlan.ipphoneVid.setValue(a["ipphoneVid"]),v.iptvVlan.ipphoneVprio.setValue(a["ipphoneVprio"]),"enable"==n?(v.iptvVlan.ipphoneVid.enable(),v.iptvVlan.ipphoneVprio.enable()):(v.iptvVlan.ipphoneVid.disable(),v.iptvVlan.ipphoneVprio.disable())),"on"==a["mciptvItem"])if(V.iptvVlanView.mciptvVlan.show(),v.iptvVlan.mciptvVid.setValue(a["mciptvVid"]),v.iptvVlan.mciptvVprio.setValue(a["mciptvVprio"]),v.iptvVlan.mciptvEnable.setValue(a["mciptvEnable"]),"enable"==n)v.iptvVlan.mciptvEnable.enable(),"on"==v.iptvVlan.mciptvEnable.getValue()?(v.iptvVlan.mciptvVid.enable(),v.iptvVlan.mciptvVprio.enable()):(v.iptvVlan.mciptvVid.disable(),v.iptvVlan.mciptvVprio.disable());else v.iptvVlan.mciptvVid.disable(),v.iptvVlan.mciptvVprio.disable(),v.iptvVlan.mciptvEnable.disable();if(a["porttype"]!=undefined){var t=a["porttype"];V.iptvVlanView.lan1.setValue(t.split(" ")[0]),V.iptvVlanView.lan2.setValue(t.split(" ")[1]),V.iptvVlanView.lan3.setValue(t.split(" ")[2]),V.iptvVlanView.lan4.setValue(t.split(" ")[3]),"enable"==n?(V.iptvVlanView.lan1.enable(),V.iptvVlanView.lan2.enable(),V.iptvVlanView.lan3.enable(),V.iptvVlanView.lan4.enable()):(V.iptvVlanView.lan1.disable(),V.iptvVlanView.lan2.disable(),V.iptvVlanView.lan3.disable(),V.iptvVlanView.lan4.disable())}else V.iptvVlanView.allVlan.hide();if(a["seltype"]!=undefined){V.iptvVlanView.lan1.disableItems(["Internet","IPTV","IP-Phone","Bridge"]),V.iptvVlanView.lan2.disableItems(["Internet","IPTV","IP-Phone","Bridge"]),V.iptvVlanView.lan3.disableItems(["Internet","IPTV","IP-Phone","Bridge"]),V.iptvVlanView.lan4.disableItems(["Internet","IPTV","IP-Phone","Bridge"]);for(var l=0,p=a["seltype"].split(" ").length;l<p;l++)V.iptvVlanView.lan1.enableItems(a["seltype"].split(" ")[l]),V.iptvVlanView.lan2.enableItems(a["seltype"].split(" ")[l]),V.iptvVlanView.lan3.enableItems(a["seltype"].split(" ")[l]),V.iptvVlanView.lan4.enableItems(a["seltype"].split(" ")[l])}else V.iptvVlanView.allVlan.hide();"none"===v.iptvVlan.mode.getValue()&&V.iptvVlanView.allVlan.hide()}}}})}},function(t,l,p,a,o,V){var n=null;return{lanNum:4,MODE:{"ADVANCED":"advanced","QUICK_SETUP":"qs"},setMode:function(e){if((n=e)===t.MODE.QUICK_SETUP){p.iptvVlan.enable.hide();e=a.modeStore.getData();r.each(e,function(e){delete e.key});var i=[{name:r.su.CHAR.NETWORK_IPTV.NONE,value:"none",boxlabel:"mode16"}].concat(e);p.iptvVlan.mode.loadItems(i)}},getMode:function(){return n},startup:function(n){p.iptvVlan.load({success:function(e){if(t.getMode()==t.MODE.ADVANCED){if(o.quickSetup.isSupportSetPort()?p.iptvPortModel.load({success:function(e){t.setlanLabels()}}):t.setlanLabels(),p.iptvVlan.enable.enable(),!V.device.getLanIptv()&&"1"==p.lanAdvLinkAggModel.enableAgg.getValue()){p.iptvVlan.enable.disable(),V.device.getConfig().supportLanAggCfg&&(p.iptvVlan.mode.hide(),l.iptvVlanView.iptvConfigWrap.hide());var i='<a href="#lanAdv">'+r.su.CHAR.NETWORK_IPTV.LA+"</a>",a=r.su.CHAR.NETWORK_IPTV.IPTV_DISABLE_TIPS.replace("%function%",i);p.iptvVlan.enable.setTips(a)}}else t.setlanLabels(),p.iptvVlan.enable.hide(),p.iptvVlan.mode.setLabelField(r.su.CHAR.NETWORK_IPTV.ISP_PRO),t.isEditable()?p.iptvVlan.enable.setValue("on"):(p.iptvVlan.mode.disable(),p.iptvVlan.enable.setValue("off"));n&&(p.iptvVlan.mode.enable(),p.iptvVlan.mode.setValue(n))}})},setlanLabels:function(){var e=p.iptvVlan.ports.getValue().split(" ");if(o.quickSetup.isSupportSetPort()){var i="1000WAN"===(t.getMode()===t.MODE.QUICK_SETUP?p.quickSetupModel.wanPortStatus.getValue():p.iptvPortModel.wanPortStatus.getValue())?r.su.CHAR.NETWORK_MAP.PORT_2500LAN:r.su.CHAR.NETWORK_MAP.PORT_1000LAN;l.iptvVlanView["lan4"].setLabelField(i),e.pop()}for(var a=0;a<e.length;a++)l.iptvVlanView["lan"+(a+1)].setLabelField(r.su.CHAR.NETWORK_IPTV.LAN+e[a])},atLeastOne:function(){for(var e=t.lanNum,i=!1,a=1;a<=e;a++)"Internet"==l.iptvVlanView["lan"+a].getValue()&&(i=!0);return!!i||(l.iptvVlanView["lan"+e].setError(r.su.CHAR.ERROR["00000095"]),!1)},vidSame:function(){if("Custom"!==p.iptvVlan.mode.getValue())return!0;var e=p.iptvVlan.internetVid.getValue()-0,i=p.iptvVlan.ipphoneVid.getValue()-0,a=p.iptvVlan.iptvVid.getValue()-0,n=p.iptvVlan.mciptvVid.getValue()-0;return e==i?(p.iptvVlan.ipphoneVid.setError(r.su.CHAR.ERROR["00000094"]),!1):i==a||e==a?(p.iptvVlan.iptvVid.setError(r.su.CHAR.ERROR["00000094"]),!1):i!=n&&e!=n&&a!=n||(p.iptvVlan.mciptvVid.setError(r.su.CHAR.ERROR["00000094"]),!1)},syncQsData:function(){var e=p.iptvVlan.getData(),a=p.quickSetupModel,i=["ispSpecialInternetVid","ispSpecialInternetVprio","ispSpecialInternetTag","ispSpecialIpphoneVid","ispSpecialIpphoneVprio","ispSpecialIptvVid","ispSpecialIptvVprio","ispSpecialMciptvEnable"];if(p.iptvVlan.validate()&&t.vidSame()&&t.atLeastOne()){switch(a.replaceData({ispSpecialMode:e.mode,ispSpecialEnable:"on"}),e.mode){case"none":a.ispSpecialEnable.setValue("off"),n(i);break;case"Bridge":a.replaceData({ispSpecialInternetTag:"off",ispSpecialMciptvEnable:"off"});break;case"Custom":a.replaceData({ispSpecialEnable:e.enable,ispSpecialInternetVid:Number(e.internetVid),ispSpecialInternetVprio:e.internetVprio,ispSpecialInternetTag:e.internetTag,ispSpecialIpphoneVid:Number(e.ipphoneVid),ispSpecialIpphoneVprio:e.ipphoneVprio,ispSpecialIptvVid:Number(e.iptvVid),ispSpecialIptvVprio:e.iptvVprio,ispSpecialMciptvEnable:e.mciptvEnable}),"on"===e.mciptvEnable&&a.replaceData({ispSpecialMciptvVid:Number(e.mciptvVid),ispSpecialMciptvVprio:e.mciptvVprio});break;default:n(i)}return"none"!==e.mode&&a.replaceData({ispSpecialPorttype:e.porttype}),p.qsSummaryModel.ispProfile.setValue(p.iptvVlan.mode.getText()),!0}return!1;function n(e){for(var i=e.length-1;i--;0<=i)a[e[i]].setValue("")}},isEditable:function(){return!(V.device.getConfig().supportLanAggCfg&&"1"==p.lanAdvLinkAggModel.enableAgg.getValue()&&!V.device.getLanIptv())}}})}(jQuery),$.su.storeManager.define("modeStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}],data:[{name:$.su.CHAR.NETWORK_IPTV.SINGAPORE_SINGTEL,value:"ExStream",boxlabel:"mode0"},{name:$.su.CHAR.NETWORK_IPTV.MALAYSIA_UNIFI,value:"Unifi",boxlabel:"mode1"},{name:$.su.CHAR.NETWORK_IPTV.MALAYSIA_MAXIS,value:"Maxis",boxlabel:"mode2"},{name:$.su.CHAR.NETWORK_IPTV.MALAYSIA_MAXIS2,value:"Maxis2",boxlabel:"mode10"},{name:$.su.CHAR.NETWORK_IPTV.CELCOM,value:"Celcom",boxlabel:"mode11"},{name:$.su.CHAR.NETWORK_IPTV.VIETNAM_VIETTEL,value:"Vietnam",boxlabel:"mode3"},{name:$.su.CHAR.NETWORK_IPTV.PORTUGAL_MEO,value:"MEO",boxlabel:"mode4"},{name:$.su.CHAR.NETWORK_IPTV.PORTUGAL_VODAFONE,value:"VDF",boxlabel:"mode5"},{name:$.su.CHAR.NETWORK_IPTV.AUSTRALIA_NBN,value:"nbn",boxlabel:"mode6"},{name:$.su.CHAR.NETWORK_IPTV.NEWZEALAND_UFB,value:"ufb",boxlabel:"mode7"},{name:$.su.CHAR.NETWORK_IPTV.TELEKOM1,value:"TELEKOM1",boxlabel:"mode12"},{name:$.su.CHAR.NETWORK_IPTV.TELEKOM2,value:"TELEKOM2",boxlabel:"mode13"},{name:$.su.CHAR.NETWORK_IPTV.AIS,value:"AIS",boxlabel:"mode14"},{name:$.su.CHAR.NETWORK_IPTV.CENTURYLINK,value:"CENTURYLINK",boxlabel:"mode15"},{name:$.su.CHAR.NETWORK_IPTV.BRIDGE,value:"Bridge",boxlabel:"mode8"},{name:$.su.CHAR.NETWORK_IPTV.CUSTOM,value:"Custom",boxlabel:"mode9"}]}),$.su.storeManager.define("lanStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}],data:[{name:$.su.CHAR.NETWORK_IPTV.INTERNET,value:"Internet",boxlabel:"lanmode0"},{name:$.su.CHAR.NETWORK_IPTV.IPTV,value:"IPTV",boxlabel:"lanmode1"},{name:$.su.CHAR.NETWORK_IPTV.VOLP,value:"IP-Phone",boxlabel:"lanmode2"},{name:$.su.CHAR.NETWORK_IPTV.BRIDGE,value:"Bridge",boxlabel:"lanmode3"}]}),$.su.storeManager.define("lanTagStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}],data:[{name:$.su.CHAR.NETWORK_IPTV.TAGGED,value:"tagged",boxlabel:"lanTag0"},{name:$.su.CHAR.NETWORK_IPTV.UNTAGGED,value:"untagged",boxlabel:"lanTag1"}]}),$.su.storeManager.define("lanPriorityStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}],data:[{name:"0",value:0,boxlabel:"lanPriority0"},{name:"1",value:1,boxlabel:"lanPriority1"},{name:"2",value:2,boxlabel:"lanPriority2"},{name:"3",value:3,boxlabel:"lanPriority3"},{name:"4",value:4,boxlabel:"lanPriority4"},{name:"5",value:5,boxlabel:"lanPriority5"},{name:"6",value:6,boxlabel:"lanPriority6"},{name:"7",value:7,boxlabel:"lanPriority7"}]}),$.su.storeManager.define("iptvVlanStore",{type:"store",fields:[{name:"lan"},{name:"lanTag"},{name:"lanComb"},{name:"lanVid",vtype:{vtype:"number",min:1,max:4096,minMaxText:$.su.CHAR.NETWORK_IPTV.VALUE_TIPS},allowBlank:!1},{name:"lanPriority"},{name:"lanTips"}],convert:function(e){for(var i=[],a=e.ports.split(" "),n=e.porttype.split(" "),t=0;t<a.length;t++)i[t]={},i[t]["lan"]="IP-Phone"===n[t]?"VoIP":n[t],i[t]["lanTag"]=e["lan"+a[t]+"Tag"],i[t]["lanVid"]=e["lan"+a[t]+"Vid"],i[t]["lanPriority"]=e["lan"+a[t]+"Priority"];return i},serialize:function(e){return{}},proxy:{url:$.su.url("/admin/iptv?form=setting")}}),$.su.define("iptvProxy",{extend:"IPFProxy",url:$.su.url("/admin/iptv?form=setting"),preventSuccessEvent:!0}),$.su.modelManager.define("iptvPortModel",{type:"model",fields:[{name:"wanPortStatus",mapping:"wan_port_status"}],proxy:{url:$.su.url("/admin/network?form=wan_port_status")}});
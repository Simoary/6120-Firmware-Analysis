!function(u){u.su.moduleManager.define("gameAccelerator",{services:["ajax","moduleLoader","moduleManager","device"],deps:["main"],models:["gameAcceleratorM","qosInfo","priorityEnable"],stores:["gameAcceleratorStore"],views:["gameAcceleratorView"],listeners:{"ev_on_launch":function(e,a,n,t,o,s,c){this.unRegisterAutoSaveData([o.gameAcceleratorStore,t.gameAcceleratorM]),t.gameAcceleratorM.load({data:{operation:"getMode"},success:function(e){"on"==e.game_mode?n.gameAcceleratorView.networkMapClientPanel.show():n.gameAcceleratorView.networkMapClientPanel.hide()}}),a.getClients(),c.moduleLoader.load({module:"gameAccelerator"},{module:"bandwidth"},n.gameAcceleratorView.qosBandwidthLoader,function(){var e=c.moduleManager.get("bandwidth");e.on("ev_qos_saved",function(e){t.gameAcceleratorM.gameMode.setValue("on"),t.priorityEnable.enable.setValue("on"),t.qosInfo.qosMode.setValue("gaming"),t.qosInfo.qosMode.record(),t.priorityEnable.enable.record(),t.gameAcceleratorM.gameMode.hideLoading(),t.priorityEnable.setOnOff({preventSuccessEvent:!0}),t.qosInfo.submit({preventSuccessEvent:!0,success:function(){a.getQosInfo()}}),t.gameAcceleratorM.submit({data:{operation:"setMode"},success:function(e){"on"==e.gameMode?n.gameAcceleratorView.networkMapClientPanel.show():n.gameAcceleratorView.networkMapClientPanel.hide()}})}),e.on("ev_qos_save_close",function(e){t.gameAcceleratorM.gameMode.hideLoading()}),e.on("ev_qos_save_cancel",function(e){t.gameAcceleratorM.gameMode.hideLoading()})}),a.getQosInfo()},"ev_before_destroy":function(e,a){a.beforeDestroy()}},init:function(c,r,i,o,d,l){this.configViews({id:"gameAcceleratorView",items:[{id:"game-connected-clients-grid",configs:{columns:[{dataIndex:"deviceName",cls:"m-hide l-hide xl-hide label-empty"},{dataIndex:"deviceType",cls:"m-hide l-hide xl-hide label-empty",renderer:function(e,a){var n="",t="",o="";switch(e=e.toLowerCase()){case"pc":n="icon-pc";break;case"phone":n="icon-phone";break;case"pad":n="icon-pad";break;case"other":n="icon-pc";break;default:n="icon-"+e}return a.isGaming&&(o='<span class="gaming-tag"></span>'),t+='<div class="device-type-container widget-container">',t+='<span class="icon '+n+' ">'+o+"</span>",null!=a.enableInternet&&(t+='<span class="text">'+(a.enableInternet?"":u.su.CHAR.NETWORK_MAP.INTERNET_PAUSED)+"</span>"),t+="</div>",t+='<div class="device-info-container widget-container">',t+='<div class="mac">'+a.mac+"</div>",t+='<div class="ip">'+("0.0.0.0"==a.ip?"":a.ip)+"</div>",t+="</div>"}},{text:u.su.CHAR.NETWORK_MAP.TYPE,width:"15%",dataIndex:"deviceType",cls:"s-hide",renderer:function(e,a){var n="",t="",o="";switch(e=e.toLowerCase()){case"pc":n="icon-pc";break;case"phone":n="icon-phone";break;case"pad":n="icon-pad";break;case"other":n="icon-pc";break;default:n="icon-"+e}return a.isGaming&&(o='<span class="gaming-tag"></span>'),t+='<div class="device-type-container widget-container">',t+='<span class="icon '+n+' ">'+o+"</span>",null!=a.enableInternet&&(t+='<span class="text">'+(a.enableInternet?"":u.su.CHAR.NETWORK_MAP.INTERNET_PAUSED)+"</span>"),t+="</div>"}},{text:u.su.CHAR.NETWORK_MAP.INFORMATION,dataIndex:"deviceName",width:"22%",cls:"s-hide",renderer:function(e,a){var n="";if("object"===u.type(a)){var t=a.deviceName;n+='<div class="device-info-container widget-container">',n+='<div class="name" title="'+t+'">'+t+"</div>",n+='<div class="mac">'+a.mac+"</div>",n+='<div class="ip">'+("0.0.0.0"==a.ip?"":a.ip)+"</div>",n+="</div>"}return n}},{text:u.su.CHAR.GAME_ACCELERATOR.REAL_TIME_RATE,dataIndex:"downloadSpeed",renderer:function(e,a){var n,t,o="",s=function(e){var a;return a=(e=parseInt(e,10))/1024<1?(0!==e&&(e=(e/1024).toFixed(2)),u.su.CHAR.NETWORK_MAP.KBPS):e/1024/1024<1?(e/1024<1e3?e=(e/1024).toFixed(1):e/=1024,u.su.CHAR.NETWORK_MAP.KBPS):(e=(e/1024/1024).toFixed(1),u.su.CHAR.NETWORK_MAP.MBPS),{speed:e,unit:a}};return"object"===u.type(a)&&(n=s(a.downloadSpeed),t=s(a.uploadSpeed),a.latency,o+='<div class="speed-upload-container widget-container">',o+='<span class="icon"></span>',o+='<span class="text">'+t.speed+"</span>",o+='<span class="unit">'+t.unit+"</span>",o+="</div>",o+='<div class="speed-download-container widget-container">',o+='<span class="icon"></span>',o+='<span class="text">'+n.speed+"</span>",o+='<span class="unit">'+n.unit+"</span>",o+="</div>"),o}},{text:u.su.CHAR.GAME_ACCELERATOR.LATENCY,dataIndex:"latency",width:"16%",cls:"s-2-col custom-action-column",tipText:u.su.CHAR.GAME_ACCELERATOR.LATENCY_HELP,renderer:function(e,a){var n="";return n+='<div class="latency-container widget-container">',n+=0<=e?'<span class="text">'+e+"</span>":'<span class="text">--- </span>',n+='<span class="unit">'+u.su.CHAR.GAME_ACCELERATOR.LATENCY_UNIT+"</span>",n+='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-latency btn-latency">',n+='<span class="icon"></span>',n+="</a>",n+="</div>"}},{text:u.su.CHAR.GAME_ACCELERATOR.GAMEING_DURATION,dataIndex:"totalGameTime",cls:"s-2-col",renderer:function(e,a){var n,t,o="",s=e;o+='<div class="duration-container widget-container">',c=parseInt(s/1440,10),n=parseInt(s%86400/60,10),t=parseInt(s%60,10),1===c?o=o+c+" "+u.su.CHAR.NETWORK_MAP.DAY+" ":1<c&&(o=o+c+" "+u.su.CHAR.NETWORK_MAP.DAYS+" "),0<n&&(o=o+n+" "+u.su.CHAR.NETWORK_MAP.H+" "),o=o+t+" "+u.su.CHAR.NETWORK_MAP.MIN,o+=" ("+u.su.CHAR.GAME_ACCELERATOR.TOTAL+")</div>";var c,r,i,d=a.currentGameTime;return o+='<div class="duration-container widget-container">',dayCurrent=parseInt(d/1440,10),r=parseInt(d%86400/60,10),i=parseInt(d%60,10),1===dayCurrent?o=o+dayCurrent+" "+u.su.CHAR.NETWORK_MAP.DAY+" ":1<dayCurrent&&(o=o+dayCurrent+" "+u.su.CHAR.NETWORK_MAP.DAYS+" "),0<r&&(o=o+r+" "+u.su.CHAR.NETWORK_MAP.H+" "),o=o+i+" "+u.su.CHAR.NETWORK_MAP.MIN,o+=" ("+u.su.CHAR.GAME_ACCELERATOR.CURRENT+")</div>"}}]}}]}),this.control({"#game-connected-clients-grid => .btn-latency":{"ev_grid_action_click":function(e,a){var n=o.gameAcceleratorStore.getModelByKey(a),t=n.ip.getValue();l.ajax.request({proxy:"gameAccGridProxy",method:"read",data:{ip:t,operation:"getLatency"},success:function(e){n.latency.setValue(e.latency)},error:function(e){},fail:function(e){}})}},"#game-accelerator-enable":{"ev_view_will_change":function(e,n){n.preventDefault();var a=function(){t()&&(changeData="on"==i.gameAcceleratorM.gameMode.getValue()?"off":"on",i.gameAcceleratorM.gameMode.setValue(changeData),i.gameAcceleratorM.submit({data:{operation:"setMode"},success:function(e){"on"==e.gameMode?r.gameAcceleratorView.networkMapClientPanel.show():r.gameAcceleratorView.networkMapClientPanel.hide()}}))},t=function(){var e=i.gameAcceleratorM.gameMode.getValue(),a=l.moduleManager.get("bandwidth");return!!("off"!=e&&e||a.hasConfigured())||(n.preventDefault(),i.gameAcceleratorM.gameMode.showLoading("on"),a.showBandwithMsg(),!1)},o="off"==i.priorityEnable.enable.getValue()&&"off"==i.gameAcceleratorM.gameMode.getValue()||"gaming"!=i.qosInfo.qosMode.getValue()&&"off"==i.gameAcceleratorM.gameMode.getValue(),s="on"==i.priorityEnable.enable.getValue()&&"on"==i.gameAcceleratorM.gameMode.getValue()&&"gaming"==i.qosInfo.qosMode.getValue();o?d.main.confirm(u.su.CHAR.QOS.GAMING_ACCELERATOR_NOTICE,function(){t()&&(a(),i.priorityEnable.enable.setValue("on"),i.priorityEnable.setOnOff({preventSuccessEvent:!0,success:function(){}}),i.qosInfo.qosMode.setValue("gaming"),i.qosInfo.submit({preventSuccessEvent:!0,success:function(){c.getQosInfo()}}))},null,u.su.CHAR.OPERATION.CONTINUE):s?d.main.confirm(u.su.CHAR.QOS.GAMING_GAMEMPDE_SWITCH_NOTICE,function(){t()&&(a(),i.qosInfo.qosMode.setValue("fair"),i.qosInfo.submit({preventSuccessEvent:!0,success:function(){c.getQosInfo()}}))},null,u.su.CHAR.OPERATION.CONTINUE):a()}}}),this.listen({"stores.gameAcceleratorStore":{"ev_data_change":function(e,a,n){var t=n.getName();a.value!==a.oldValue&&"enablePriority"===t&&o.gameAcceleratorStore.sync()}}})}},function(e,a,n,t,o,s){var c=null;return{getClients:function(){var e={data:{operation:"loadDevice"},success:function(e){t.gameAcceleratorStore.load({data:{operation:"loadSpeed"}})}};t.gameAcceleratorStore.load(e),clearInterval(c),c=setInterval(function(){t.gameAcceleratorStore.load({data:{operation:"loadSpeed"}})},1e4)},getQosInfo:function(){n.priorityEnable.getOnOff(),n.qosInfo.load({success:function(){var e=n.qosInfo.getData();!0===s.device.getConfig().supportGFN&&("fair"==e.qosMode?(n.priorityEnable.enable.setValue("off"),n.qosInfo.qosMode.setDisabled()):(n.priorityEnable.enable.setValue("on"),n.qosInfo.qosMode.setAbled())),n.qosInfo.qosMode.setSelected(e.qosMode)}})},getAccessControlMode:function(e){var a;e&&(a=e.success),n.accessControl.load({success:function(e){a&&a(n.accessControl.getData())}})},beforeDestroy:function(){clearInterval(c)},getIPaddr:function(e){return""},getConnectType:function(e){return""}}})}(jQuery);
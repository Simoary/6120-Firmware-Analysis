!function(s){s.su.moduleManager.define("login",{deps:["main"],services:["moduleLoader","ajax","device","moduleManager","language"],stores:["loginLanguageStore"],models:["firmwareModel","loginLanguage"],views:["loginView"],listeners:{"ev_on_launch":function(e,o,i,n,a,t,r){localStorage.setItem("userInfo",""),s.su.scrollbar({ele:".login-view"});o=this;var l=r.device.getLocale();r.device.getForce()?(o.lang=l,i.loginView.switchLanBtn.setText(s.su.CHAR.LANGUAGE[l.toUpperCase()]),n.loginLanguage.language.disable()):a.loginLanguageStore.load({success:function(){o.lang=l,n.loginLanguage.language.setValue(l),i.loginView.switchLanBtn.setText(s.su.CHAR.LANGUAGE[l.toUpperCase()])}}),n.firmwareModel.load({success:function(){var e=n.firmwareModel.getData().hardwareVersion;r.device.getConfig().supportFirmwareInfoReplace&&(e=e.replace("v1.0","v1.0/v1.20")),i.loginView.hardwareVersion.setValue(e)}});var u=r.device.getProductName();document.title=u,i.loginView.productName.setValue(u),i.loginView.currentOperation.setValue(u),o.cloudLogined=!1,r.ajax.request({proxy:"firstTimeProxy",method:"read",success:function(e){s.encrypt.encryptManager.cleanStorage(),s.su.encryptor=s.encrypt.encryptManager.genEncryptor();var n=e;1==n.is_default?(o.goToChildModule("initLogin"),o.firmwareDefault=!0,o.cloudLogined=!1):0==n.cloud_ever_login?(o.goToChildModule("localLogin"),o.firmwareDefault=!1,o.cloudLogined=!1):(o.goToChildModule("localLogin"),o.firmwareDefault=!1,o.cloudLogined=!0)}}),r.ajax.request({url:s.su.url("/domain_login?form=dlogin"),data:{operation:"read"},success:function(e){var n=e;if(n&&!0===n.conflict)switch(n.mode){case 0:i.loginView.situation0.show(),i.loginView.situation1.hide(),i.loginView.ipConflict0.setText(s.su.CHAR.INIT.IMPORTANT_UPDATE_INFO+" "+n.new_addr+s.su.CHAR.INIT.END);break;case 1:i.loginView.situation0.hide(),i.loginView.situation1.show(),i.loginView.ipConflict1.setText(s.su.CHAR.INIT.IMPORTANT_UPDATE_INFO+" "+n.new_addr+" "+s.su.CHAR.INIT.OR+" "+n.dst_addr+s.su.CHAR.INIT.END2),o.dstAddress="//"+n.dst_addr+n.dst_webpath,i.loginView.dstBtn.setText(n.dst_addr),i.loginView.newBtn.setText(n.new_addr)}n&&n.redirect&&(location.href=n.redirect)}})}},init:function(e,n,o,i,a,t){this.control({"#ip-conflict-confirm-btn":{"ev_button_click":function(){n.loginView.situation0.hide()}},"#ip-conflict-situation-1-dst":{"ev_button_click":function(){window.location.href=e.dstAddress}},"#ip-conflict-situation-1-new":{"ev_button_click":function(){n.loginView.situation1.hide()}},"#login-lan-cb":{"mouseenter":function(){s("#login-lan-button").addClass("hover")},"mouseleave":function(){s("#login-lan-button").removeClass("hover")},"ev_view_change":function(e,n){t.language.switchTo(n.value)}},"#login-secondary-lan-cb":{"mouseenter":function(){s("#login-secondary-lan-button").addClass("hover")},"mouseleave":function(){s("#login-secondary-lan-button").removeClass("hover")},"ev_view_change":function(e,n){t.language.switchTo(n.value)}},"#mobile-login-secondary-lan-cb":{"mouseenter":function(){s("#mobile-login-secondary-lan-button").addClass("hover")},"mouseleave":function(){s("#mobile-login-secondary-lan-button").removeClass("hover")},"ev_view_change":function(e,n){t.language.switchTo(n.value)}}})}},function(n,a,e,o,i,t){return{dstAddress:"",setSecondContainerTitle:function(e){a.loginView.currentOperation.setValue(e)},goToChildModule:(l=function(e){var n=e+"Loader";return a.loginView[n]},u=[],c={"initLogin":{"container":"mainContainer","reLaunchWhenShow":!0},"localLogin":{"container":"mainContainer","reLaunchWhenShow":!0},"tpLogin":{"container":"mainContainer","reLaunchWhenShow":!0},"tpSignUp":{"container":"secondaryContainer","reLaunchWhenShow":!0},"localPwdRecovery":{"container":"secondaryContainer","reLaunchWhenShow":!0},"tpCloud":{"container":"secondaryContainer","reLaunchWhenShow":!0}},function(e,n){r&&l(r).hide(),"mainContainer"===c[e].container?(a.loginView.secondaryContainer.hide(),a.loginView.mainContainer.show()):"secondaryContainer"===c[e].container&&(a.loginView.mainContainer.hide(),a.loginView.secondaryContainer.show());var o,i=l(e);i.show(),0<=s.inArray(e,u)||("tpCloud"==e&&t.moduleManager.get("tpLogin").unLoad(),t.moduleLoader.load({module:"login",view:"loginView"},{module:e,view:(o=e,"tpLogin"===o?"tpLoginView":null)},i,n),!c[e].reLaunchWhenShow&&u.push(e)),r=e}),supportCloud:function(){return!0},CHECK_INTERNET_URL:s.su.url("/login?form=check_internet"),hasInternet:function(){var e=s.Deferred();return t.ajax.request({url:n.CHECK_INTERNET_URL,success:function(){e.resolve(!0)},fail:function(){e.resolve(!1)},error:function(){e.resolve(!1)}}),e.promise()},showLoading:function(){i.main.showMask(),a.loginView.pageLoadingSd.show()},hideLoading:function(){i.main.hideMask(),a.loginView.pageLoadingSd.hide()},unLoad:function(){t.moduleLoader.unLoad(a.loginView.tpCloudLoader)}};var r,l,u,c})}(jQuery);
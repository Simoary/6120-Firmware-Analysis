!function(w){w.su.moduleManager.define("portForwarding",{deps:["utils"],services:[],models:["lanAdvLanModel"],stores:["portForwardingStore","natProtocolStore","portForwardingCommonServicesStore","portForwardingConnectedDevicesStore"],views:["portForwardingView"],listeners:{"ev_on_launch":function(e,v,a,A,I,m,t){A.lanAdvLanModel.load(),I.portForwardingStore.load(),this.control({"#port-forwarding-grid":{"ev_grid_before_save":function(e,t){var r=I.portForwardingStore.getEditingModel(),n=A.lanAdvLanModel.ipaddr.getValue(),a=A.lanAdvLanModel.maskType.getValue();switch(a){case 0:a="255.255.255.0";break;case 1:a="255.255.0.0";break;case 2:a="255.0.0.0";break;default:a="custom"}var o="CUSTOM"==a.toUpperCase()?A.lanAdvLanModel.customValue.getValue():a,i=r.ipAddress.getValue();if(!m.utils.isSameNet(i,n,o))return r.ipAddress.setError(w.su.CHAR.ERROR["00000110"]),t.preventDefault(),!1;if(i==m.utils.getLimitIp(n,o,"min"))return r.ipAddress.setError(w.su.CHAR.ERROR["00000134"]),t.preventDefault(),!1;if(i==m.utils.getLimitIp(n,o,"max"))return r.ipAddress.setError(w.su.CHAR.ERROR["00000134"]),t.preventDefault(),!1;if(i==n)return r.ipAddress.setError(w.su.CHAR.ERROR["00000077"]),t.preventDefault(),!1;var s=r.externalPort.getValue(),d=r.protocol.getValue(),l=(r.enable.getValue(),s.split("-"));if(2==l.length&&parseInt(l[0],10)>parseInt(l[1],10)){var p=l[0];l[0]=l[1],l[1]=p}var c=I.portForwardingStore.getData();if(w.isArray(c)&&0<c.length)for(var u=0;u<c.length;u++){var g=c[u],R=g.protocol;if(g.key!==r.key.getValue()){var f=g["externalPort"].split("-");if(2==f.length&&parseInt(f[0],10)>parseInt(f[1],10)){p=f[0];f[0]=f[1],f[1]=p}if(1==l.length){if(1==f.length){if(parseInt(l[0],10)==parseInt(f[0],10)&&v.containProtocol(d,R))return r.externalPort.setError(w.su.CHAR.ERROR["00000065"]),t.preventDefault(),!1}else if(parseInt(l[0],10)>=parseInt(f[0],10)&&parseInt(l[0],10)<=parseInt(f[1],10)&&v.containProtocol(d,R))return r.externalPort.setError(w.su.CHAR.ERROR["00000065"]),t.preventDefault(),!1}else if(1==f.length){if(parseInt(l[0],10)<=parseInt(f[0],10)&&parseInt(l[1],10)>=parseInt(f[0],10)&&v.containProtocol(d,R))return r.externalPort.setError(w.su.CHAR.ERROR["00000065"]),t.preventDefault(),!1}else if(!(parseInt(l[0],10)>parseInt(f[1],10)||parseInt(l[1],10)<parseInt(f[0],10))&&v.containProtocol(d,R))return r.externalPort.setError(w.su.CHAR.ERROR["00000065"]),t.preventDefault(),!1}}return!0}},"#port-forwarding-common-service":{"ev_button_click":function(e){a.portForwardingView.portForwardingCommonService.show()}},"#port-forwarding-common-service-kinds":{"ev_item_click":function(e,t,r){var n=I.portForwardingStore.getEditingModel();n.name.setValue(r.name),n.externalPort.setValue(r.port),n.internalPort.setValue(r.port),n.protocol.setValue(r.protocol),a.portForwardingView.portForwardingCommonService.close()}},"#port-forwarding-connected-devices":{"ev_button_click":function(e){I.portForwardingConnectedDevicesStore.load({success:function(){a.portForwardingView.portForwardingConnectedDevices.setPosition("center","center")}}),a.portForwardingView.portForwardingConnectedDevices.show()}},"#port-forwarding-connected-devices-items":{"ev_item_click":function(e,t){I.portForwardingStore.getEditingModel().ipAddress.setValue(t.ipAddress),a.portForwardingView.portForwardingConnectedDevices.close()}},"#port-forwarding-external-port":{"ev_textbox_blur":function(){var e=I.portForwardingStore.getEditingModel();if(1==e.externalPort.getValid()){var t=e.externalPort.getValue(),r=t.split("-");1==r.length?isNaN(parseInt(r[0],10))||(t=parseInt(r[0],10)):2==r.length&&(isNaN(parseInt(r[0],10))||isNaN(parseInt(r[1],10))||(t=parseInt(r[0],10)+"-"+parseInt(r[1],10))),e.externalPort.setValue(t)}}},"#port-forwarding-internal-port":{"ev_textbox_blur":function(e,t){var r=I.portForwardingStore.getEditingModel();if(1==r.internalPort.getValid()){var n=r.internalPort.getValue();isNaN(parseInt(n,10))||(n=parseInt(n,10)),r.internalPort.setValue(n)}}}}),this.listen({"stores.portForwardingStore":{"ev_data_change":function(e,t,r){t.value!=t.oldValue&&"enable"==r.getName()&&I.portForwardingStore.sync()}}})}},init:function(e,t,r,n,a,o){this.configViews({id:"portForwardingView",items:[{id:"port-forwarding-grid",configs:{popEditor:{addTitle:w.su.CHAR.PORT_FORWARDING.POP_TITLE,content:"#port-forwarding-grid-pop-editor",fields:[{name:"name"},{name:"ipAddress"},{name:"externalPort"},{name:"internalPort"},{name:"protocol"}]},columns:[{text:w.su.CHAR.PORT_FORWARDING.SERVICE_NAME,dataIndex:"name"},{text:w.su.CHAR.PORT_FORWARDING.STATUS,dataIndex:"enable",xtype:"customWidget",widgetName:"switch",cls:"status l-hide xl-hide",settings:{trueValue:"on",falseValue:"off"}},{text:w.su.CHAR.PORT_FORWARDING.DEVICE_IP_ADDRESS,dataIndex:"ipAddress",width:120},{text:w.su.CHAR.PORT_FORWARDING.EXTERNAL_PORT,dataIndex:"externalPort"},{text:w.su.CHAR.PORT_FORWARDING.INTERNAL_PORT,dataIndex:"internalPort"},{text:w.su.CHAR.PORT_FORWARDING.PROTOCOL,dataIndex:"protocol",renderer:function(e){return"ALL"==e?w.su.CHAR.PORT_FORWARDING.ALL:"TCP"==e?w.su.CHAR.PORT_FORWARDING.TCP:w.su.CHAR.PORT_FORWARDING.UDP}},{text:w.su.CHAR.PORT_FORWARDING.STATUS,dataIndex:"enable",xtype:"customWidget",widgetName:"switch",cls:"status s-hide m-hide",settings:{trueValue:"on",falseValue:"off"}},{xtype:"actioncolumn",text:w.su.CHAR.PORT_FORWARDING.MODIFY,renderer:function(e,t){return'<span class="icon"></span>','<span class="text"></span>',"</a>",'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-delete btn-delete">','<span class="icon"></span>','<span class="text"></span>',"</a>",'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit"><span class="icon"></span><span class="text"></span></a><a href="javascript:void(0)" class="grid-content-btn grid-content-btn-delete btn-delete"><span class="icon"></span><span class="text"></span></a>'}}]}},{id:"port-forwarding-common-service-kinds",itemRender:function(e,t){var r='<div class="common-service-kinds-layout">';return r+='<div class="common-service-kinds">',r+="<span>"+t.name+"</span>",r+="</div>",r+="</div>"}},{id:"port-forwarding-connected-devices-items",configs:[{type:"logo",dataIndex:"deviceType"},{type:"deviceName",dataIndex:"name"},{type:"ip",dataIndex:"ipAddress"},{type:"mac",dataIndex:"macAddress"}]}]})}},function(e,t,r,n,a,o){return{containProtocol:function(e,t){return"ALL"==e||("TCP"==e&&"UDP"!=t||"UDP"==e&&"TCP"!=t)}}})}(jQuery);
!function(i){i.su.moduleManager.define("lanAPAdv",{models:["lanAPModel"],stores:["lanAdvSubnetCombo","ipTypeStore"],services:[],deps:["utils"],views:["lanAPView"],listeners:{"ev_on_launch":function(e,l,a,n,t,o,i){n.lanAPModel.load()}},init:function(e,i,s,l,a,n){this.control({".index-common-save-btn":{"ev_will_auto_save":function(e,l){l.preventDefault();var a=s.lanAPModel.lan_type.getValue(),n=s.lanAPModel.isDirty(),t=s.lanAPModel.ipaddr.isDirty();if("dynamic"!==a){if(s.lanAPModel.validate()&&n&&this.lanValidate())if(t)i.lanAPView.lanApIpChangeMsg.show();else{var o=s.lanAPModel.ipaddr.getValue();this.startReboot(o)}}else this.startReboot("tplinkwifi.net")}},"#lan-ap-ip-change":{"ev_msg_ok":function(){var e=s.lanAPModel.ipaddr.getValue();this.startReboot(e)}}}),this.listen({"models.lanAPModel.mask_type":{"ev_value_change":function(e,l,a){3===l?(s.lanAPModel.custom_value.show(),"static"===s.lanAPModel.lan_type.getValue()?s.lanAPModel.custom_value.enable():s.lanAPModel.custom_value.disable()):(s.lanAPModel.custom_value.hide(),s.lanAPModel.custom_value.disable())}},"models.lanAPModel.lan_type":{"ev_value_change":function(e,l,a){"static"===l?(s.lanAPModel.ipaddr.enable(),s.lanAPModel.mask_type.enable(),3===parseInt(s.lanAPModel.mask_type.getValue())?s.lanAPModel.custom_value.enable():s.lanAPModel.custom_value.disable(),s.lanAPModel.lan_gw.enable()):(s.lanAPModel.ipaddr.disable(),s.lanAPModel.mask_type.disable(),s.lanAPModel.custom_value.disable(),s.lanAPModel.lan_gw.disable())}}})}},function(l,a,t,e,o,n){return{lanValidate:function(){var e=t.lanAPModel.ipaddr.getValue(),l=parseInt(t.lanAPModel.mask_type.getValue()),a=3===l?t.lanAPModel.custom_value.getValue():["255.255.255.0","255.255.0.0","255.0.0.0"][l],n=t.lanAPModel.lan_gw.getValue();return o.utils.isNetIp(e,a)||o.utils.isBroadCastIp(e,a)?(t.lanAPModel.ipaddr.setError(i.su.CHAR.ERROR["00000059"]),!1):o.utils.isSameNet(n,e,a)?!o.utils.isNetIp(n,a)&&!o.utils.isBroadCastIp(n,a)||(t.lanAPModel.lan_gw.setError(i.su.CHAR.ERROR["00000059"]),!1):(t.lanAPModel.lan_gw.setError(i.su.CHAR.ERROR["00000045"]),!1)},goToNewUrl:function(e){var l=top.location.href,a=l.indexOf("//");top.location.href=l.slice(0,a+2)+e},startReboot:function(e){a.lanAPView.lanApAdvRebootAnimate.show(),t.lanAPModel.submit({success:function(){setTimeout(function(){a.lanAPView.lanApAdvRebootAnimate.close(function(){l.goToNewUrl(e)})},4e4)}})}}})}(jQuery);
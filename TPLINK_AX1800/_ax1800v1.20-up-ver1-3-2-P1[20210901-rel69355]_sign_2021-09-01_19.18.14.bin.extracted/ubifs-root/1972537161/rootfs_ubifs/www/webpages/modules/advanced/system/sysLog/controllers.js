!function(n){n.su.moduleManager.define("sysLog",{models:["sysLogModel","runningTimeModel","saveLogModel"],stores:["logTypeStore","frequencyStore","sysLogStore"],services:["ajax","time"],views:["sysLogView"],listeners:{"ev_on_launch":function(e,s,o,a,i,l,t){this.unRegisterAutoSaveData([a.sysLogModel,a.saveLogModel]),"ios"===n.su.platform&&o.sysLogView.saveLocalBtn.hide(),i.sysLogStore.load(),i.logTypeStore.load(),a.sysLogModel.load(),a.saveLogModel.load(),t.time.on("on_time_change",s.onTimeChange)},"ev_before_destroy":function(e,s){s.beforeDestroy()}},init:function(o,i,l,e,s,a){this.configViews({id:"sysLogView",items:[{id:"system-log-information",configs:{convert:function(e){var s,o;return s=n.su.CHAR.SYSTEM_LOG[e.type],o=n.su.CHAR.SYSTEM_LOG[e.level],s&&(e.type=s),o&&(e.level=o),[e.time,e.type,e.level,e.content].join(" ")}}}]}),this.listen({"models.sysLogModel.type":{"ev_value_change":function(e,s,o){o&&o!==s&&this.filterLog(s)}},"models.saveLogModel":{"ev_loaded":function(e,s){o.saveEmailFlag=!!s.to,o.saveEmailFlag&&i.sysLogView.autoMailField.show(),i.sysLogView.mailToLabel.setValue(s.to)}},"models.saveLogModel.autoMailType":{"ev_value_change":function(e,s,o){var a=l.saveLogModel;"on"===a.autoMail.getValue()&&("day_time"===s?(a.everyDayTime.enable(),a.everyDayTime.show(),a.everyHours.disable(),a.everyHours.hide(),i.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE)):(a.everyHours.enable(),a.everyHours.show(),a.everyDayTime.disable(),a.everyDayTime.hide(),i.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE_AND_SEND)))}},"models.saveLogModel.auth":{"ev_value_change":function(e,s,o){"on"===s?(l.saveLogModel.username.enable(),l.saveLogModel.username.show(),l.saveLogModel.password.enable(),l.saveLogModel.password.show()):(l.saveLogModel.username.disable(),l.saveLogModel.username.hide(),l.saveLogModel.password.disable(),l.saveLogModel.password.hide())}},"models.saveLogModel.autoMail":{"ev_value_change":function(e,s,o){var a=l.saveLogModel;"on"===s?(a.autoMailType.enable(),a.autoMailType.show(),"day_time"===a.autoMailType.getValue()?(a.everyDayTime.enable(),a.everyDayTime.show(),a.everyHours.disable(),a.everyHours.hide(),i.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE)):(a.everyHours.enable(),a.everyHours.show(),a.everyDayTime.disable(),a.everyDayTime.hide(),i.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE_AND_SEND))):(a.autoMailType.disable(),a.autoMailType.hide(),a.everyDayTime.disable(),a.everyDayTime.hide(),a.everyHours.disable(),a.everyHours.hide(),i.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE))}}}),this.control({"#mail-log-btn":{"ev_button_click":function(){o.saveEmailFlag?o.sendEmail():(i.sysLogView.setMailTip.show(),i.sysLogView.mailLogMsg.show()),i.sysLogView.sendEmailStatus.hide()}},"#save-local-btn":{"ev_button_click":function(){o.saveLog()}},"#mail-edit-btn":{"ev_button_click":function(){i.sysLogView.setMailTip.hide(),i.sysLogView.mailLogMsg.show(),i.sysLogView.sendEmailStatus.hide()}},"#mail-log-msg-submit-btn":{"ev_button_click":function(){l.saveLogModel.submit({success:function(e){o.saveEmailFlag=!0,i.sysLogView.mailToLabel.setValue(l.saveLogModel.to.getValue()),i.sysLogView.mailLogMsg.hide(),i.sysLogView.setMailTip.hide(),"on"===l.saveLogModel.autoMail.getValue()&&"hours"===l.saveLogModel.autoMailType.getValue()&&o.sendEmail(),l.saveLogModel.to.getValue()&&i.sysLogView.autoMailField.show()},fail:function(e){i.sysLogView.mailLogMsg.hide()},error:function(e){i.sysLogView.mailLogMsg.hide()}})}},"#mail-log-msg-cancel-btn":{"ev_button_click":function(){i.sysLogView.mailLogMsg.hide()}}})}},function(e,i,s,o,a,l){return{saveEmailFlag:!1,sendEmail:function(){l.ajax.request({proxy:"sendMailProxy",success:function(e){"undefined"!=typeof e.send&&(i.sysLogView.sendEmailStatus.show(),e.send?i.sysLogView.sendEmailStatus.setSuccess(n.su.CHAR.SYSTEM_LOG.SEND_OK):i.sysLogView.sendEmailStatus.setFailed(n.su.CHAR.SYSTEM_LOG.SEND_FAILED))}})},saveLog:function(){l.ajax.upload({proxy:"saveLogProxy",fileId:"save-log-file"})},filterLog:function(e){s.sysLogModel.submit({preventSuccessEvent:!0,success:function(){o.sysLogStore.load()}})},onTimeChange:function(e,s){var o=l.time.getHour24(),a=l.time.format(s,"yyyy-MM-dd HH:mm:ss",o);i.sysLogView.currentTime.setValue(a)},beforeDestroy:function(){l.time.off("on_time_change",e.onTimeChange)}}})}(jQuery);
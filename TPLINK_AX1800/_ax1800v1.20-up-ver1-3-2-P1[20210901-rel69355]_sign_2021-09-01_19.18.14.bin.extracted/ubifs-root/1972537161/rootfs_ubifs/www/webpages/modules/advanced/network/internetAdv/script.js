jQuery.su.moduleManager.define("internetAdv",{services:["moduleLoader","moduleManager"],stores:[],views:["internetAdvView"],models:[],listeners:{ev_on_launch:function(e,n,t,a,o,i,s){s.moduleLoader.load({module:"internetAdv"},{module:"internet",view:"internetView"},t.internetAdvView.internetLoader,function(){var e=s.moduleManager.get("internet");e.setMode(e.MODE.ADVANCED),e.startup()})}}},function(e,n,t,a,o,i){return{}}),function(r){r.su.moduleManager.define("internetBigpond",{views:["internetBigpondView","internetBigpondViewBasic"],models:["internetBigpondModel","ipv4Status"],stores:["internetBigpondConnModeStore"],deps:["internet"],services:["ajax","timer"],listeners:{"ev_on_launch":function(e,t,n,a,o,i,s){t.unRegisterAutoSaveData([a.ipv4Status]),this.listen({"models.internetBigpondModel.connMode":{"ev_value_change":function(e,n){switch(a.internetBigpondModel.demandIdle.hide(),a.internetBigpondModel.manualIdle.hide(),n){case"demand":a.internetBigpondModel.demandIdle.show();break;case"manually":a.internetBigpondModel.manualIdle.show()}}},"models.internetBigpondModel":{"ev_before_load_data":function(e,n){}},"models.ipv4Status.conntype":{"ev_value_change":function(e,n){"bigpond"===n&&"bigpond"===i.internet.dutConnType?t.startRefreshInterval():t.stopRefreshInterval()}}}),a.internetBigpondModel.load({success:function(){a.internetBigpondModel.conntype.setValue("bigpond")}}),"bigpond"===a.ipv4Status.conntype.getValue()&&"bigpond"===i.internet.dutConnType&&t.startRefreshInterval()},"ev_before_destroy":function(){this.beforeDestroy()}}},function(a,e,n,t,o,i){var s;return{validateDial:function(){var e=r.Deferred();return n.internetBigpondModel.isDirty()?n.internetBigpondModel.validate()?e.resolve(!0):e.reject():e.resolve(!1)},submit:function(){var e=n.internetBigpondModel.conntype.getBackup();n.internetBigpondModel.submit({success:function(){o.internet.afterSubmitDial(e,"bigpond"),a.startRefreshInterval()}})},refreshData:function(){i.ajax.request({proxy:"bigpondRefreshProxy",data:{operation:"read",share:o.internet.getShareflag()},success:function(e){var n=e.data,t=o.internet.getShareflag();o.internet.trigger("ev_conn_from_data_loaded",[n]),t!=o.internet.getShareflag()&&a.refreshData(),"bigpond"===n.connType||a.stopRefreshInterval()}})},startRefreshInterval:function(){clearInterval(s),s=i.timer.setInterval(a,function(){a.refreshData()},o.internet.pollingInterval,!0)},stopRefreshInterval:function(){clearInterval(s)},beforeDestroy:function(){n.internetBigpondModel.reset(),this.unRegisterAutoSaveData(n.internetBigpondModel),a.stopRefreshInterval()}}})}(jQuery),$.su.modelManager.define("internetBigpondModel",{fields:[{name:"conntype",mapping:"conntype"},{name:"username",mapping:"username",maxLength:118,minLength:0,vtype:"string_visible_allow_blank"},{name:"password",mapping:"password",maxLength:118,minLength:0,vtype:"password"},{name:"server",mapping:"server",maxLength:31,minLength:0,vtype:"string_visible"},{name:"domain",mapping:"domain",maxLength:31,minLength:0,vtype:"string_visible"},{name:"mtu",mapping:"mtu",allowBlank:!1,valueType:"number",maxLength:4,vtype:{vtype:"number",max:1500,min:576}},{name:"connMode",mapping:"conn_mode"},{name:"demandIdle",mapping:"demand_idle",allowBlank:!1,valueType:"number",vtype:{vtype:"number",max:99,min:0}},{name:"manualIdle",mapping:"manual_idle",allowBlank:!1,valueType:"number",vtype:{vtype:"number",max:99,min:0}}],proxy:{url:$.su.url("/admin/network?form=wan_ipv4_bigpond")}}),$.su.storeManager.define("internetBigpondConnModeStore",{type:"store",fields:[{name:"value"},{name:"name"}],data:[{value:"auto",name:$.su.CHAR.NETWORK_INTERNET.AUTO},{value:"demand",name:$.su.CHAR.NETWORK_INTERNET.ON_DEMAND},{value:"manually",name:$.su.CHAR.NETWORK_INTERNET.MANUAL}]}),$.su.define("bigpondRefreshProxy",{extend:"IPFProxy",url:$.su.url("/admin/network?form=wan_ipv4_bigpond"),readFilter:function(e){return{data:{pppshare:(e=e.data).pppshare,connType:e.conntype,connStatus:e.conn_status,inetIp:e.inet_ip,inetPridns:e.inet_pridns,inetSnddns:e.inet_snddns,dynIp:e.dyn_ip,dynNetmask:e.dyn_netmask,dynGateway:e.dyn_gateway,dynPridns:e.dyn_pridns,dynSnddns:e.dyn_snddns}}},writeFilter:function(e){return{share:e.share,operation:"read"}}}),function(s){s.su.moduleManager.define("internetDslite",{services:["moduleManager"],models:["quickSetupModel","ipv4Status","dsliteModel"],stores:["dsliteModes"],deps:["internet"],views:["internetDsliteView","internetDsliteViewBasic","internetDsliteViewQs"],listeners:{"ev_on_launch":function(e,n,t,a,o,i,s){n.unRegisterAutoSaveData([a.ipv4Status]),this.control(),this.listen({"models.dsliteModel.dynMode":{"ev_value_change":function(e,n){"1"===n?(a.dsliteModel.afrName.hide(),a.dsliteModel.afrName.disable()):(a.dsliteModel.afrName.enable(),a.dsliteModel.afrName.show())}}}),a.dsliteModel.load({success:function(){var e=a.dsliteModel;e.conntype.setValue("dslite"),e.supportDyn.getValue()?(e.dynMode.show(),e.afrName.setLabelVisible(!1)):(e.afrName.setLabelVisible(!0),e.dynMode.disable(),e.afrName.show())}})},"ev_before_destroy":function(){this.beforeDestroy()}}},function(a,e,o,n,t,i){return{validateDial:function(){var e=o.dsliteModel,n=s.Deferred();if(!e.isDirty())return n.resolve(!1);if(!o.dsliteModel.validate())return n.reject();var t=i.moduleManager.get("main");return t&&t.confirm(a.getUnavialModuleHtml(s.su.CHAR.NETWORK_INTERNET.DSLITE_WARNING),function(){n.resolve(!0)},function(){n.reject()},s.su.CHAR.OPERATION.OK),n.promise()},getUnavialModuleHtml:function(e){for(var n=i.moduleManager.get("navigatorController").getV6DsliteHiddenName(),t=0,a=n.length,o="";t<a;t++)o+="<p>"+n[t]+"</p>";return e+o},submit:function(){var e=o.dsliteModel.conntype.getBackup(),n=s.Deferred();return o.dsliteModel.submit({ajax:{timeout:2e4},success:function(){t.internet.afterSubmitDial(e,"dslite"),n.resolve()},fail:function(){n.reject()},error:function(){n.reject()}}),n.promise()},syncQsData:function(){var e=o.dsliteModel;if(e.validate()){var n=e.getData(),t={networkDhcpMacCloneType:"default"};return n.supportDyn?(t.networkDsliteDynMode=n.dynMode,"1"!==n.dynMode&&(t.networkDsliteAftrName=n.afrName)):o.quickSetupModel.replaceData({networkDhcpMacCloneType:"default",networkDsliteAftrName:n.afrName}),o.quickSetupModel.replaceData(t),!0}return!1},beforeDestroy:function(){o.dsliteModel.reset(),this.unRegisterAutoSaveData(o.dsliteModel)}}})}(jQuery),$.su.modelManager.define("dsliteModel",{fields:[{name:"supportDyn",mapping:"is_support_dynamic_mode",convert:function(e){return"1"===e},disabled:!0},{name:"dynMode",mapping:"dynamic_mode"},{name:"afrName",mapping:"AFTR_name",allowBlank:!1,vtype:"ipv6||domain"},{name:"conntype"}],proxy:{url:$.su.url("/admin/network?form=wan_ipv4_dslite")}}),$.su.storeManager.define("dsliteModes",{fields:[{name:"name"},{name:"value"}],data:[{value:"1",name:$.su.CHAR.IPV6.AUTO},{value:"0",name:$.su.CHAR.IPV6.MANUAL}]}),function(r){r.su.moduleManager.define("internetDynamicIP",{services:["moduleManager","ajax","timer"],models:["dynamicIPModel","dynamicIPControlModel","ipv4Status"],stores:["dnsAddressOptionStore"],views:["internetDynamicIPView","internetDynamicIPViewQs","internetDynamicIPViewBasic"],deps:["internet"],listeners:{"ev_on_launch":function(e,a,o,i,n,s,t){a.unRegisterAutoSaveData([i.ipv4Status]),this.control({"#dhcp-renew-btn":{"ev_button_click":function(){o.internetDynamicIPView.dynamicRenewStatus.hide(),i.dynamicIPControlModel.renewBtn.loading(!0),i.dynamicIPModel.load({data:{operation:"renew"},success:function(e){i.dynamicIPControlModel.renewBtn.loading(!1),o.internetDynamicIPView.dynamicRenewStatus.show(),o.internetDynamicIPView.dynamicRenewStatus.setSuccess(r.su.CHAR.NETWORK_INTERNET.SUCCESS),setTimeout(function(){o.internetDynamicIPView.dynamicRenewStatus.hide()},5e3),s.internet.changeButtonStatus(e.conn_status,i.dynamicIPControlModel.renewBtn,i.dynamicIPControlModel.releaseBtn)},fail:function(){i.dynamicIPControlModel.renewBtn.loading(!1),o.internetDynamicIPView.dynamicRenewStatus.show(),o.internetDynamicIPView.dynamicRenewStatus.setSuccess(r.su.CHAR.NETWORK_INTERNET.FAILED),setTimeout(function(){o.internetDynamicIPView.dynamicRenewStatus.hide()},5e3)},error:function(){i.dynamicIPControlModel.renewBtn.loading(!1),o.internetDynamicIPView.dynamicRenewStatus.show(),o.internetDynamicIPView.dynamicRenewStatus.setSuccess(r.su.CHAR.NETWORK_INTERNET.FAILED),setTimeout(function(){o.internetDynamicIPView.dynamicRenewStatus.hide()},5e3)}})}},"#dhcp-release-btn":{"ev_button_click":function(){o.internetDynamicIPView.dynamicReleaseStatus.hide(),i.dynamicIPControlModel.releaseBtn.loading(!0),i.dynamicIPModel.load({data:{operation:"release"},success:function(e){i.dynamicIPControlModel.releaseBtn.loading(!1),o.internetDynamicIPView.dynamicReleaseStatus.show(),o.internetDynamicIPView.dynamicReleaseStatus.setSuccess(r.su.CHAR.NETWORK_INTERNET.SUCCESS),setTimeout(function(){o.internetDynamicIPView.dynamicReleaseStatus.hide()},5e3),s.internet.changeButtonStatus(e.conn_status,i.dynamicIPControlModel.renewBtn,i.dynamicIPControlModel.releaseBtn)},fail:function(){i.dynamicIPControlModel.releaseBtn.loading(!1),o.internetDynamicIPView.dynamicReleaseStatus.show(),o.internetDynamicIPView.dynamicReleaseStatus.setSuccess(r.su.CHAR.NETWORK_INTERNET.FAILED),setTimeout(function(){o.internetDynamicIPView.dynamicReleaseStatus.hide()},5e3)},error:function(){i.dynamicIPControlModel.releaseBtn.loading(!1),o.internetDynamicIPView.dynamicReleaseStatus.show(),o.internetDynamicIPView.dynamicReleaseStatus.setSuccess(r.su.CHAR.NETWORK_INTERNET.FAILED),setTimeout(function(){o.internetDynamicIPView.dynamicReleaseStatus.hide()},5e3)}})}},"#dynamic-advanced-panel":{"ev_panel_open":function(){a.initDynamicAdv(!0)},"ev_panel_close":function(){a.initDynamicAdv(!1)}}}),this.listen({"models.dynamicIPModel.dnsMode":{"ev_value_change":function(e,n){switch(n){case"dynamic":i.dynamicIPModel.manualPridns.hide(),i.dynamicIPModel.manualPridns.disable(),i.dynamicIPModel.manualSnddns.hide(),i.dynamicIPModel.manualSnddns.disable();break;case"static":i.dynamicIPModel.manualPridns.show(),i.dynamicIPModel.manualPridns.enable(),i.dynamicIPModel.manualSnddns.show(),i.dynamicIPModel.manualSnddns.enable()}}},"models.dynamicIPModel":{"ev_will_auto_save":function(e,n){n.preventDefault()}},"models.ipv4Status.conntype":{"ev_value_change":function(e,n){"dhcp"===n&&"dhcp"===s.internet.dutConnType?a.startRefreshInterval():a.stopRefreshInterval()}},"models.dynamicIPModel.dnsMode":{"ev_value_change":function(e,n,t){s.internet.getMode()===a.MODE.BASIC?(i.dynamicIPModel.manualPridns.hide(),i.dynamicIPModel.manualSnddns.hide(),"dynamic"===n&&(i.dynamicIPModel.manualPridns.disable(),i.dynamicIPModel.manualSnddns.disable())):"dynamic"===n?(o.internetDynamicIPView.dynAdvBasicCnt.show(),o.internetDynamicIPView.dynAdvManualCnt.hide()):(o.internetDynamicIPView.dynAdvManualCnt.show(),o.internetDynamicIPView.dynAdvBasicCnt.hide())}}}),i.dynamicIPModel.load({success:function(e){i.dynamicIPModel.conntype.setValue("dhcp"),s.internet.changeButtonStatus(e.conn_status,i.dynamicIPControlModel.renewBtn,i.dynamicIPControlModel.releaseBtn)}}),"dhcp"===i.ipv4Status.conntype.getValue()&&"dhcp"===s.internet.dutConnType&&a.startRefreshInterval()},"ev_before_destroy":function(){this.beforeDestroy()}}},function(a,n,o,e,i,s){var t;return{MODE:{"ADVANCED":"advanced","BASIC":"basic","QUICK_SETUP":"qs"},validateDial:function(){var e=o.dynamicIPModel,n=r.Deferred();if(!e.isDirty())return n.resolve(!1);if(!e.validate())return n.reject();if(e.hostname.isDirty()&&/[\~\!\@\#\$\%\^\&\*\(\)\+\=\|\\\{\}\[\]\:\"\;\'\<\>\?\,\.\/]+/.test(e.hostname.getValue())){var t=s.moduleManager.get("main");t&&t.confirm(r.su.CHAR.NETWORK_INTERNET.HOST_NAME_CONFIRM,function(){n.resolve(!0)},function(){n.reject()},r.su.CHAR.OPERATION.OK)}else n.resolve(!0);return n.promise()},submit:function(){a.submitDial({success:function(){a.startRefreshInterval()}})},submitDial:function(e){var n=o.dynamicIPModel.conntype.getBackup(),t=e.success;e.success=function(e){i.internet.afterSubmitDial(n,"dhcp"),t&&t(e)},o.dynamicIPModel.submit(e)},refreshData:function(){s.ajax.request({proxy:"dynamicRefreshProxy",data:{operation:"read",share:i.internet.getShareflag()},success:function(e){var n=e.data,t=i.internet.getShareflag();i.internet.trigger("ev_conn_from_data_loaded",[n]),t!=i.internet.getShareflag()&&a.refreshData(),"dhcp"===n.connType?(o.dynamicIPModel.replaceData(n,!1,!0),i.internet.changeButtonStatus(n.connStatus,o.dynamicIPControlModel.renewBtn,o.dynamicIPControlModel.releaseBtn)):a.stopRefreshInterval()}})},startRefreshInterval:function(){"internetDynamicIPView"===this.getEffectiveView()&&(clearInterval(t),t=s.timer.setInterval(a,function(){a.refreshData()},i.internet.pollingInterval,!0))},stopRefreshInterval:function(){clearInterval(t)},beforeDestroy:function(){o.dynamicIPModel.reset(),this.unRegisterAutoSaveData(o.dynamicIPModel),a.stopRefreshInterval()},initDynamicAdv:function(e){e?(o.dynamicIPModel.dnsMode.show(),"dynamic"==o.dynamicIPModel.dnsMode.getValue()?(n.internetDynamicIPView.dynAdvBasicCnt.show(),n.internetDynamicIPView.dynAdvManualCnt.hide()):(n.internetDynamicIPView.dynAdvManualCnt.show(),n.internetDynamicIPView.dynAdvBasicCnt.hide())):(o.dynamicIPModel.dnsMode.hide(),n.internetDynamicIPView.dynAdvBasicCnt.hide(),n.internetDynamicIPView.dynAdvManualCnt.hide())}}})}(jQuery),$.su.modelManager.define("dynamicIPModel",{fields:[{name:"conntype",mapping:"conntype"},{name:"ipaddr",mapping:"ipaddr"},{name:"netmask",mapping:"netmask"},{name:"gateway",mapping:"gateway"},{name:"linkStatus",mapping:"link_status"},{name:"connStatus",mapping:"conn_status"},{name:"priDns",mapping:"pri_dns"},{name:"sndDns",mapping:"snd_dns"},{name:"dnsMode",mapping:"dns_mode"},{name:"dynPridns",mapping:"dyn_pridns"},{name:"dynSnddns",mapping:"dyn_snddns"},{name:"manualPridns",mapping:"manual_pridns",allowBlank:!1,vtype:"ip"},{name:"manualSnddns",mapping:"manual_snddns",vtype:"ip"},{name:"mtu",mapping:"mtu",allowBlank:!1,valueType:"number",maxLength:4,vtype:{vtype:"number",max:1500,min:576,minMaxText:$.su.CHAR.NETWORK_INTERNET.VALUE_TIPS+" "+$.su.CHAR.NETWORK_INTERNET.VALUE_DEFAULT+"1500."}},{name:"hostname",mapping:"hostname",maxLength:63,vtype:"string_visible"},{name:"unicast",mapping:"unicast"}],proxy:{url:$.su.url("/admin/network?form=wan_ipv4_dynamic")}}),$.su.modelManager.define("dynamicIPControlModel",{fields:[{name:"renewBtn"},{name:"releaseBtn"},{name:"hostNameConfirmMsg"}]}),$.su.storeManager.define("dnsAddressOptionStore",{type:"store",fields:[{name:"value"},{name:"name"}],data:[{value:"dynamic",name:$.su.CHAR.NETWORK_INTERNET.DNS_ADDRESS_AUTO},{value:"static",name:$.su.CHAR.NETWORK_INTERNET.DNS_ADDRESS_MANUAL}]}),$.su.define("dynamicRefreshProxy",{extend:"IPFProxy",url:$.su.url("/admin/network?form=wan_ipv4_dynamic"),readFilter:function(e){return{data:{ipaddr:(e=e.data).ipaddr,netmask:e.netmask,gateway:e.gateway,priDns:e.pri_dns,sndDns:e.snd_dns,dynPridns:e.dyn_pridns,dynSnddns:e.dyn_snddns,pppshare:e.pppshare,connType:e.conntype,connStatus:e.conn_status}}},writeFilter:function(e){return{share:e.share,operation:"read"}}}),function(h){h.su.moduleManager.define("internet",{services:["moduleLoader","moduleManager","ajax","device"],deps:["index","internetNatAndWan","main"],stores:["internetConnTypeStore"],models:["internetViewControl","ipv4Status","ipv4NetStatus","dynamicIPModel","staticIPModel","pppoeModel","l2tpModel","pptpModel","internetBigpondModel","macConfigModel"],views:["internetView","internetViewBasic","internetViewQs"],listeners:{"ev_on_launch":function(e,n,t,a,o,i,s){n.unRegisterAutoSaveData([a.ipv4Status])},"ev_conn_from_data_loaded":function(e,n){this.checkShareFlagFromLoadedData(n)}},init:function(C,E,o,e,T,n){this.control({".index-common-save-btn":{"ev_button_click":function(){var t,e=C.getCurrentChildConnModule(),u=n.moduleManager.get(e),c=o.ipv4Status.conntype.getValue(),m=n.moduleManager.get("internetPortConfig"),f=o.macConfigModel,a=!0===n.device.getConfig().supportSelectPort,M=function(){var e=h.Deferred();return f.submit({success:e.resolve,fail:e.reject,error:e.reject}),e},g=function(e){for(var n=0,t=e.length;n<t;n++)e[n]()},v={1:[100],2:[50,100],3:[40,60,100]},y=[],_=[];f.validate()&&(t=h.Deferred(),u.validateDial().then(function(n){a?m.validatePort().then(function(e){t.resolve(n,e)}):t.resolve(n,!1)},function(){t.reject()}),t).then(function(e,n){n&&(y.push({submit:m.submitPort,time:15e3}),_.push(m.afterSubmitPort)),f.isDirty()&&y.push({submit:M,time:7e3}),e&&("dslite"===c||"v6plus"===c?y.push({submit:u.submit,time:15e3}):_.push(u.submit));var t=y.length;if(0===t)T.internetNatAndWan.submit(),g(_);else{var i=E[C.getCurrentViewName()],a=v[t],s=i.httpRestartProgress;T.main.toggelVisibleMask(!0);for(var o=function(e,n,t,a,o){return function(){return e().then(function(){o&&i.httpRestartMsg.show();var e=h.Deferred();return s.animate({duration:a,percentageStart:n,percentageEnd:t,callback:function(){e.resolve()}}),e})}},r=0,p=0,d=null,l=null;r<t;r++)d=y[r],l=l?l.then(o(d.submit,p,a[r],d.time,0===r)):o(d.submit,p,a[r],d.time,0===r)(),p=a[r];l.then(function(){T.internetNatAndWan.submit(),g(_)}).always(function(){T.main.toggelVisibleMask(!1),E[C.getCurrentViewName()].httpRestartMsg.hide()})}})},"ev_will_auto_save":function(e,n){n.preventDefault()}},".internet-conn-type-select":{"ev_view_change":function(e,n){n.value,C.connType}}}),this.listen({"models.ipv4Status.enable":{"ev_value_change":function(e,n){"on"===n?o.internetViewControl.internetEditField.show():o.internetViewControl.internetEditField.hide()}},"models.ipv4Status":{"ev_before_load_data":function(e,n){C.dutConnType=n.conntype}},"models.ipv4Status.conntype":{"ev_value_change":function(e,n){if(C.responseInternetTypeValueChange(n),C.getMode()===C.MODE.BASIC)switch(n){case"dhcp":o.ipv4Status.conntype.setTips(h.su.CHAR.NETWORK_INTERNET.DYNAMIC_INTRO);break;case"static":o.ipv4Status.conntype.setTips(h.su.CHAR.NETWORK_INTERNET.STATIC_INTRO);break;case"pppoe":o.ipv4Status.conntype.setTips(h.su.CHAR.NETWORK_INTERNET.PPPOE_INTRO);break;case"l2tp":o.ipv4Status.conntype.setTips(h.su.CHAR.NETWORK_INTERNET.L2TP_INTRO);break;case"pptp":o.ipv4Status.conntype.setTips(h.su.CHAR.NETWORK_INTERNET.PPTP_INTRO);break;case"dslite":o.ipv4Status.conntype.setTips(h.su.CHAR.NETWORK_INTERNET.DSLITE_INTRO);break;case"v6plus":o.ipv4Status.conntype.setTips(h.su.CHAR.NETWORK_INTERNET.V6_PLUS_INTRO)}}}})}},function(a,e,o,t,i,s){a=this;var n,r,p,d,l=null;return{dutConnType:null,qsInternetType:null,getShareflag:function(){return n},setShareflag:function(e){n=e},checkShareFlagFromLoadedData:function(e){e.hasOwnProperty("pppshare")&&1==e.pppshare?a.setShareflag(1):a.setShareflag(0),a.dutConnType=e.connType},startup:function(){o.ipv4NetStatus.load({success:function(){var e;e=a.getCurrentViewName(),s.moduleLoader.load({module:"internet",view:e},{module:"internetMacConfig",view:"internetMacConfigView"},o.internetViewControl.internetMacConfigLoader),"internetView"===e&&s.moduleLoader.load({module:"internet",view:"internetView"},{module:"internetNatAndWan"},o.internetViewControl.internetNatAndWanLoader),!0!==s.device.getConfig().supportSelectPort||"internetView"!==e&&"internetViewBasic"!==e||(o.internetViewControl.internetTitle.setTitle(h.su.CHAR.NETWORK_INTERNET.INTERNET_CONNECTION),s.moduleLoader.load({module:"internet",view:e},{module:"internetPortConfig",view:"internetPortConfigView"},o.internetViewControl.internetPortLoader));var n={operation:"read",advanced:a.getMode()===a.MODE.ADVANCED};o.ipv4Status.load(),t.internetConnTypeStore.load({data:n,success:function(){"internetView"!=a.getEffectiveView()&&t.internetConnTypeStore.hideItems("bigpond")}})}})},getLanIP:function(){return o.ipv4NetStatus.lanIpv4IpAddr.getValue()},getLanMask:function(){return o.ipv4NetStatus.lanIpv4Netmask.getValue()},pollingInterval:3e3,MODE:{"ADVANCED":"advanced","BASIC":"basic","QUICK_SETUP":"qs"},setMode:function(e){l=e},getMode:function(){return l},connTypeValueToModuleMap:{"dhcp":"internetDynamicIP","static":"internetStaticIP","pppoe":"internetPPPOE","l2tp":"internetL2TP","pptp":"internetPPTP","bigpond":"internetBigpond","dslite":"internetDslite","v6plus":"internetV6plus"},getCurrentViewName:function(){var e;switch(a.getMode()){case a.MODE.ADVANCED:e="internetView";break;case a.MODE.BASIC:e="internetViewBasic";break;case a.MODE.QUICK_SETUP:e="internetViewQs"}return e},getCurrentChildConnModule:function(){return a.connTypeValueToModuleMap[o.ipv4Status.conntype.getValue()]},responseInternetTypeValueChange:function(e){var n=a.connTypeValueToModuleMap[e],t=a.getMode();a.qsInternetType=e,a.switchInternetType(n),t===a.MODE.QUICK_SETUP&&o.ipv4NetStatus.load({success:function(){s.moduleLoader.load({module:"internet",view:a.getCurrentViewName()},{module:"internetMacConfig",view:"internetMacConfigView"},o.internetViewControl.internetMacConfigLoader,function(){s.moduleManager.get("internetMacConfig").hidePanel()})}}),t!==a.MODE.BASIC&&t!==a.MODE.QUICK_SETUP||("dhcp"===e?o.internetViewControl.internetMacConfigLoader.show():(o.internetViewControl.internetMacConfigLoader.hide(),o.macConfigModel.reset()))},switchInternetType:(p=[],d=function(e){return o.internetViewControl[e+"Loader"]},function(e){if(l&&e&&d(e)){if(r!==undefined){d(r).hide();var n=s.moduleManager.get(r);n.trigger("ev_before_destroy",[n])}var t=d(e);s.moduleLoader.load({module:"internet",view:a.getCurrentViewName()},{module:e,view:function(e){var n;switch(l){case a.MODE.ADVANCED:n=e+"View";break;case a.MODE.BASIC:n=e+"ViewBasic";break;case a.MODE.QUICK_SETUP:n=e+"ViewQs"}return n}(e)},t),p.push(e),t.show(),r=e}}),preventCommonAutoSave:function(e,n){n.preventDefault()},beforeDestroy:function(){var e=s.moduleManager.get("index");a.isListeningCommonSave&&e&&e.off("ev_before_save_data",a.preventCommonAutoSave)},submitPort:function(){s.moduleManager.get("internetPortConfig").submit()},syncQsData:function(){var e;switch(a.qsInternetType){case"dhcp":e=s.moduleManager.get("internetMacConfig");break;case"static":e=s.moduleManager.get("internetStaticIP");break;case"pppoe":e=s.moduleManager.get("internetPPPOE");break;case"l2tp":e=s.moduleManager.get("internetL2TP");break;case"pptp":e=s.moduleManager.get("internetPPTP");break;case"dslite":e=s.moduleManager.get("internetDslite");break;case"v6plus":e=s.moduleManager.get("internetV6plus")}return e.syncQsData()},judgeEmptyInput:function(e){return null===e||e===undefined||""===e},validateInet:function(){var e=a.getCurrentChildConnModule();return s.moduleManager.get(e).validateDial()},changeButtonStatus:function(e,n,t){switch(e.toUpperCase()){case"CONNECTED":n.disable(),t.enable();break;case"DISCONNECTED":n.enable(),t.disable();break;case"CONNECTING":n.enable(),t.enable()}},afterSubmitDial:function(e,n){var t=["dslite","v6plus"],a=0<=t.indexOf(e),o=0<=t.indexOf(n);s.device.switchDialType(n),(a&&!o||!a&&o)&&i.index.reloadMenu()}}})}(jQuery),$.su.storeManager.define("internetConnTypeStore",{type:"store",fields:[{name:"name"},{name:"value"}],convert:function(e){for(var n=[],t=0;t<e.length;t++){var a={};switch(a.value=e[t].value,e[t].value){case"dhcp":a.name=$.su.CHAR.NETWORK_INTERNET.DYNAMIC_IP;break;case"static":a.name=$.su.CHAR.NETWORK_INTERNET.STATIC_IP;break;case"pppoe":a.name=$.su.CHAR.NETWORK_INTERNET.PPPOE;break;case"l2tp":a.name=$.su.CHAR.NETWORK_INTERNET.L2TP;break;case"pptp":a.name=$.su.CHAR.NETWORK_INTERNET.PPTP;break;case"bigpond":a.name=$.su.CHAR.NETWORK_INTERNET.BIGPOND_CABLE;break;case"dslite":a.name=$.su.CHAR.NETWORK_INTERNET.DSLITE;break;case"v6plus":a.name=$.su.CHAR.NETWORK_INTERNET.V6_PLUS}n.push(a)}return n},proxy:{url:$.su.url("/admin/network?form=wan_ipv4_protos")}}),$.su.modelManager.define("ipv4Status",{fields:[{name:"enable"},{name:"conntype"},{name:"autodetect"}],convert:function(e){return e.enable===undefined&&(e.enable="on"),e},proxy:{url:$.su.url("/admin/network?form=wan_ipv4_status")}}),$.su.modelManager.define("ipv4NetStatus",{fields:[{name:"lanIpv4IpAddr",mapping:"lan_ipv4_ipaddr"},{name:"lanIpv4Netmask",mapping:"lan_ipv4_netmask"},{name:"wanIpv4IpAddr",mapping:"wan_ipv4_ipaddr"},{name:"wanIpv4Netmask",mapping:"wan_ipv4_netmask"},{name:"wan_macaddr"}],proxy:{url:$.su.url("/admin/network?form=status_ipv4")}}),$.su.modelManager.define("internetViewControl",{fields:[{name:"enable"},{name:"internetEditField"},{name:"macCloneIntro"},{name:"macCloneType"},{name:"mac"},{name:"internetDynamicIPLoader"},{name:"internetStaticIPLoader"},{name:"internetBigpondLoader"},{name:"internetPPPOELoader"},{name:"internetL2TPLoader"},{name:"internetPPTPLoader"},{name:"internetDsliteLoader"},{name:"internetV6plusLoader"},{name:"internetType"},{name:"internetTypeIntro"},{name:"dhcpDnsAddressType"},{name:"dhcpDnsManualPrimary"},{name:"dhcpDnsManualSecondary"},{name:"dhcpMacCloneType"},{name:"dhcpMac"},{name:"internetMacConfigLoader"},{name:"internetNatAndWanLoader"},{name:"internetPortLoader"},{name:"internetTitle"}]}),function(u){u.su.moduleManager.define("internetL2TP",{services:["vtype","ajax","moduleManager","timer"],stores:["l2tpIpTypeStore","internetConnModeStore2"],views:["internetL2TPView","internetL2TPViewBasic","internetL2TPViewQs"],deps:["utils","internet"],models:["l2tpModel","l2tpControlModel","ipv4Status","quickSetupModel","pppoeControlModel","macConfigModel","natModel","internetPortModel"],listeners:{"ev_on_launch":function(e,t,n,i,a,o,s){t.unRegisterAutoSaveData([i.ipv4Status]),this.control({"#l2tp-conn-btn":{"ev_button_click":function(){i.l2tpModel.validate()&&i.pppoeControlModel.connBtn.loading(!0),t.submitDial({data:{operation:"connect"},success:function(e){i.pppoeControlModel.connBtn.loading(!1),o.internet.changeButtonStatus(e.connStatus,i.l2tpControlModel.connBtn,i.l2tpControlModel.disConnBtn)},fail:function(){i.pppoeControlModel.connBtn.loading(!1)},error:function(){i.pppoeControlModel.connBtn.loading(!1)}})}},"#l2tp-disconn-btn":{"ev_button_click":function(){i.l2tpModel.validate()&&i.pppoeControlModel.disConnBtn.loading(!0),t.submitDial({data:{operation:"disconnect"},success:function(e){i.pppoeControlModel.disConnBtn.loading(!1),o.internet.changeButtonStatus(e.connStatus,i.l2tpControlModel.connBtn,i.l2tpControlModel.disConnBtn)},fail:function(){i.pppoeControlModel.disConnBtn.loading(!1)},error:function(){i.pppoeControlModel.disConnBtn.loading(!1)}})}},"#qs-check-username-and-pwd-msg":{"ev_msg_ok":function(){t.syncQsDfd.resolve()}}}),this.listen({"models.l2tpModel.sndConn":{"ev_value_change":function(e,n){switch(n){case"static":i.l2tpControlModel.staticEditField.show(),i.l2tpControlModel.dynamicEditField.hide();break;default:i.l2tpControlModel.staticEditField.hide(),i.l2tpControlModel.dynamicEditField.show()}}},"models.l2tpModel.connMode":{"ev_value_change":function(e,n){if(i.l2tpModel.demandIdle.hide(),i.l2tpModel.manualIdle.hide(),i.l2tpControlModel.periodContainer.hide(),i.l2tpModel.connMode.setTips(""),"internetL2TPView"===this.getEffectiveView())switch(n){case"demand":i.l2tpModel.demandIdle.enable(),i.l2tpModel.demandIdle.show(),i.l2tpModel.connMode.setTips(u.su.CHAR.NETWORK_INTERNET.CONN_TYPE_TIPS);break;case"time_based":i.l2tpControlModel.periodContainer.enable(),i.l2tpControlModel.periodContainer.show();break;case"manually":i.l2tpModel.manualIdle.enable(),i.l2tpModel.manualIdle.show(),i.l2tpModel.connMode.setTips(u.su.CHAR.NETWORK_INTERNET.MANUAL_TIPS)}else i.l2tpModel.demandIdle.disable(),i.l2tpModel.manualIdle.disable(),i.l2tpControlModel.periodContainer.hide()}},"models.ipv4Status.conntype":{"ev_value_change":function(e,n){"l2tp"===n&&"l2tp"===o.internet.dutConnType?t.startRefreshInterval():t.stopRefreshInterval()}},"models.l2tpModel.timeStart":{"ev_value_change":function(e,n){var t=n,a=i.l2tpModel.timeEnd.getValue();if("string"==typeof t&&"string"==typeof a){var o=parseInt(t.replace(":",""),10);parseInt(a.replace(":",""),10)<=o?i.l2tpModel.timeEnd.setShortTips(u.su.CHAR.NETWORK_INTERNET.NEXT_DAY_TIP):i.l2tpModel.timeEnd.setShortTips("&nbsp;")}}},"models.l2tpModel.timeEnd":{"ev_value_change":function(e,n){var t=i.l2tpModel.timeStart.getValue(),a=n;if("string"==typeof t&&"string"==typeof a){var o=parseInt(t.replace(":",""),10);parseInt(a.replace(":",""),10)<=o?i.l2tpModel.timeEnd.setShortTips(u.su.CHAR.NETWORK_INTERNET.NEXT_DAY_TIP):i.l2tpModel.timeEnd.setShortTips("&nbsp;")}}}}),i.l2tpModel.load({success:function(e){i.l2tpModel.conntype.setValue("l2tp"),o.internet.changeButtonStatus(e.conn_status,i.l2tpControlModel.connBtn,i.l2tpControlModel.disConnBtn)}}),"l2tp"===i.ipv4Status.conntype.getValue()&&"l2tp"===o.internet.dutConnType&&t.startRefreshInterval()},"ev_before_destroy":function(){this.beforeDestroy()}}},function(a,n,p,e,d,l){var t,o=function(e){return null===e||e===undefined||""===e};return{validate:function(){if("dynamic"===p.l2tpModel.sndConn.getValue())return!0;var e=p.l2tpModel.staticIp.getValue(),n=p.l2tpModel.staticNetmask.getValue(),t=p.l2tpModel.staticGateway.getValue(),a=p.l2tpModel.staticServer.getValue(),o=p.l2tpModel.staticPridns.getValue(),i=d.internet.getLanIP(),s=d.internet.getLanMask(),r=l.vtype;if(""!=a&&1==r.validate(a,"ip")&&!d.utils.isSameNet(a,e,n)&&""==t)return p.l2tpModel.staticGateway.setError(u.su.CHAR.ERROR["00000062"]),!1;if(""!=a&&1!=r.validate(a,"ip")){if(!d.utils.isSameNet(o,e,n)&&""==t)return p.l2tpModel.staticGateway.setError(u.su.CHAR.ERROR["00000062"]),!1;if(""==o)return p.l2tpModel.staticPridns.setError(u.su.CHAR.ERROR["00000062"]),!1}return d.utils.isNetIpLegal(e,n)?d.utils.isNetIp(e,n)||d.utils.isBroadCastIp(e,n)?(p.l2tpModel.staticIp.setError(),p.l2tpModel.staticNetmask.setError(u.su.CHAR.ERROR["00000150"]),!1):!d.utils.isSameNet(i,e,n)&&!d.utils.isSameNet(e,i,s)||(p.l2tpModel.staticIp.setError(),p.l2tpModel.staticNetmask.setError(u.su.CHAR.ERROR["00000060"]),!1):(p.l2tpModel.staticIp.setError(),p.l2tpModel.staticNetmask.setError(u.su.CHAR.ERROR["00000150"]),!1)},validateDial:function(){var e=p.l2tpModel,n=u.Deferred();if(!e.isDirty())return n.resolve(!1);if(1!=e.validate()||!a.validate())return n.reject();if(o(e.username.getValue())||o(e.password.getValue())){var t=l.moduleManager.get("main");t&&t.confirm(u.su.CHAR.NETWORK_INTERNET.BLANK_USERNAME_PWD_PROMPT,function(){n.resolve(!0)},function(){n.reject()},u.su.CHAR.OPERATION.OK)}else n.resolve(!0);return n.promise()},submit:function(){a.submitDial({success:function(){a.startRefreshInterval()}})},submitDial:function(e){var n=p.l2tpModel.conntype.getBackup(),t=e.success;e.success=function(e){d.internet.afterSubmitDial(n,"l2tp"),t&&t(e)},p.l2tpModel.submit(e)},refreshData:function(){l.ajax.request({proxy:"l2tpRefreshProxy",data:{operation:"read",share:d.internet.getShareflag()},success:function(e){var n=e.data,t=d.internet.getShareflag();d.internet.trigger("ev_conn_from_data_loaded",[n]),t!=d.internet.getShareflag()&&a.refreshData(),"l2tp"===n.connType?(p.l2tpModel.replaceData(n,!1,!0),d.internet.changeButtonStatus(n.connStatus,p.l2tpControlModel.connBtn,p.l2tpControlModel.disConnBtn)):a.stopRefreshInterval()}})},startRefreshInterval:function(){"internetL2TPView"===this.getEffectiveView()&&(clearInterval(t),t=l.timer.setInterval(a,function(){a.refreshData()},d.internet.pollingInterval,!0))},stopRefreshInterval:function(){clearInterval(t)},beforeDestroy:function(){p.l2tpModel.reset(),this.unRegisterAutoSaveData(p.l2tpModel),a.stopRefreshInterval()},syncQsData:function(){var e=p.l2tpModel.getData();return!(!p.l2tpModel.validate()||!a.validate())&&(p.quickSetupModel.replaceData({networkDhcpMacCloneType:"default",networkL2tpUsername:e.username,networkL2tpPassword:e.password,networkL2tpSndConn:e.sndConn}),"dynamic"===e.sndConn?p.quickSetupModel.networkL2tpDynServer.setValue(e.dynServer):p.quickSetupModel.replaceData({networkL2tpStaticServer:e.staticServer,networkL2tpStaticIp:e.staticIp,networkL2tpStaticNetmask:e.staticNetmask,networkL2tpStaticGateway:e.staticGateway,networkL2tpStaticPridns:e.staticPridns,networkL2tpStaticSnddns:e.staticSnddns}),!o(p.l2tpModel.username.getValue())&&!o(p.l2tpModel.password.getValue())||(n.internetL2TPViewQs.checkUsernameAndPwdMsg.show(),a.syncQsDfd=u.Deferred(),a.syncQsDfd))}}})}(jQuery),$.su.modelManager.define("l2tpModel",{fields:[{name:"conntype",mapping:"conntype"},{name:"username",mapping:"username",maxLength:255,minLength:0,vtype:"string_visible_allow_blank"},{name:"password",mapping:"password",maxLength:255,minLength:0,vtype:"password"},{name:"inetIp",mapping:"inet_ip"},{name:"inetPridns",mapping:"inet_pridns"},{name:"inetSnddns",mapping:"inet_snddns"},{name:"sndConn",mapping:"snd_conn"},{name:"dynServer",mapping:"dyn_server",allowBlank:!1,maxLength:63,minLength:0,vtype:"string_ip_domain"},{name:"dynIp",mapping:"dyn_ip"},{name:"dynNetmask",mapping:"dyn_netmask"},{name:"dynGateway",mapping:"dyn_gateway"},{name:"dynPridns",mapping:"dyn_pridns"},{name:"dynSnddns",mapping:"dyn_snddns"},{name:"staticPridns",mapping:"static_pridns"},{name:"staticSnddns",mapping:"static_snddns"},{name:"staticServer",mapping:"static_server",allowBlank:!1,maxLength:63,minLength:0,vtype:"string_ip_domain"},{name:"staticIp",mapping:"static_ip",allowBlank:!1,vtype:"ip"},{name:"staticNetmask",mapping:"static_netmask",allowBlank:!1,vtype:"netmask"},{name:"staticGateway",mapping:"static_gateway",vtype:"ip"},{name:"staticPridns",mapping:"static_pridns",vtype:"ip"},{name:"staticSnddns",mapping:"static_snddns",vtype:"ip"},{name:"mtu",mapping:"mtu",allowBlank:!1,valueType:"number",maxLength:4,vtype:{vtype:"number",max:1460,min:576,minMaxText:$.su.CHAR.NETWORK_INTERNET.VALUE_TIPS+" "+$.su.CHAR.NETWORK_INTERNET.VALUE_DEFAULT+"1460."}},{name:"connMode",mapping:"conn_mode"},{name:"demandIdle",mapping:"demand_idle",allowBlank:!1,valueType:"number",maxLength:2,vtype:{vtype:"number",max:99,min:0}},{name:"connStatus",mapping:"conn_status"},{name:"timeStart",mapping:"time_start"},{name:"timeEnd",mapping:"time_end"},{name:"manualIdle",mapping:"manual_idle",allowBlank:!1,valueType:"number",maxLength:2,vtype:{vtype:"number",max:99,min:0}}],proxy:{url:$.su.url("/admin/network?form=wan_ipv4_l2tp")}}),$.su.modelManager.define("l2tpControlModel",{fields:[{name:"connBtn"},{name:"disConnBtn"},{name:"staticEditField"},{name:"dynamicEditField"},{name:"checkUsernameAndPwdMsg"},{name:"checkUsernameAndPwdPromptText"},{name:"periodContainer"}]}),$.su.storeManager.define("l2tpIpTypeStore",{type:"store",fields:[{name:"value"},{name:"boxlabel"}],data:[{value:"dynamic",boxlabel:$.su.CHAR.NETWORK_INTERNET.DYNAMIC},{value:"static",boxlabel:$.su.CHAR.NETWORK_INTERNET.STATIC}]}),$.su.define("l2tpRefreshProxy",{extend:"IPFProxy",url:$.su.url("/admin/network?form=wan_ipv4_l2tp"),readFilter:function(e){return{data:{pppshare:(e=e.data).pppshare,connType:e.conntype,connStatus:e.conn_status,inetIp:e.inet_ip,inetPridns:e.inet_pridns,inetSnddns:e.inet_snddns,dynIp:e.dyn_ip,dynNetmask:e.dyn_netmask,dynGateway:e.dyn_gateway,dynPridns:e.dyn_pridns,dynSnddns:e.dyn_snddns}}},writeFilter:function(e){return{share:e.share,operation:"read"}}}),$.su.storeManager.define("internetConnModeStore2",{type:"store",fields:[{name:"value"},{name:"name"}],data:[{value:"auto",name:$.su.CHAR.NETWORK_INTERNET.AUTO},{value:"demand",name:$.su.CHAR.NETWORK_INTERNET.ON_DEMAND},{value:"manually",name:$.su.CHAR.NETWORK_INTERNET.MANUAL}]}),function(r){r.su.moduleManager.define("internetMacConfig",{services:[],models:["macConfigModel","quickSetupModel","ipv4NetStatus"],stores:["macCloneStore","macCloneSimpleStore"],views:["internetMacConfigView","internetMacConfigViewQs"],deps:["internet"],listeners:{"ev_on_launch":function(e,n,t,a,o,i,s){i.internet.getMode()==i.internet.MODE.BASIC?t.internetMacConfigView.internetMacConfigPanel.setInstruction(r.su.CHAR.NETWORK_INTERNET.MAC_CLONE_INTRO):t.internetMacConfigView.internetMacConfigPanel.setInstruction(""),a.macConfigModel.load(),a.macConfigModel.macComputer.disable(),a.macConfigModel.macDefault.disable()}},init:function(e,n,i,t,a,o){this.control({"#mac-copy-button":{"ev_button_click":function(){i.macConfigModel.macCustom.setValue(i.macConfigModel.macComputer.getValue())}}}),this.listen({"models.macConfigModel.macCloneType":{"ev_value_change":function(e,n){i.macConfigModel.macDefault.hide(),i.macConfigModel.macCustom.hide(),i.macConfigModel.macCustom.disable(),i.macConfigModel.macComputer.hide(),"custom"===n?(i.macConfigModel.macCustom.show(),i.macConfigModel.macCustom.enable()):"computer"===n?i.macConfigModel.macComputer.show():i.macConfigModel.macDefault.show()}},"models.macConfigModel.macComputer":{"ev_value_change":function(e,n,t){var a=i.ipv4NetStatus.wan_macaddr.getValue().toUpperCase(),o=i.macConfigModel.macCloneType.getValue();null==t&&"computer"===o&&a!=n&&(i.macConfigModel.macCloneType.setValue("custom"),i.macConfigModel.macCustom.setValue(a),i.macConfigModel.record(),i.macConfigModel.macCustom.setValue(a))}}})}},function(e,n,t,a,o,i){return{macCloneType:n.internetMacConfigView.macCloneType,mac:n.internetMacConfigView.mac,hidePanel:function(){n.internetMacConfigView.internetMacConfigPanel.hideTitle()},syncQsData:function(){var e=t.macConfigModel.macCloneType.getValue(),n="custom"===e?t.macConfigModel.macCustom.getValue():"";return!!t.macConfigModel.macCustom.validate()&&(t.quickSetupModel.networkDhcpMacCloneType.setValue(e),t.quickSetupModel.networkDhcpMacCustom.setValue(n),!0)}}})}(jQuery),$.su.storeManager.define("macCloneStore",{type:"store",fields:[{name:"name"},{name:"value"}],data:[{value:"default",name:$.su.CHAR.NETWORK_INTERNET.MAC_CLONE_DEFAULT},{value:"computer",name:$.su.CHAR.NETWORK_INTERNET.MAC_CLONE_COMPUTER},{value:"custom",name:$.su.CHAR.NETWORK_INTERNET.MAC_CLONE_CUSTOM}]}),$.su.storeManager.define("macCloneSimpleStore",{type:"store",fields:[{name:"name"},{name:"value"}],data:[{value:"default",name:$.su.CHAR.NETWORK_INTERNET.MAC_CLONE_DEFAULT},{value:"computer",name:$.su.CHAR.NETWORK_INTERNET.MAC_CLONE_COMPUTER}]}),$.su.modelManager.define("macConfigModel",{fields:[{name:"macCloneType",mapping:"mac_clone_type"},{name:"macDefault",mapping:"mac_default",vtype:"mac",maxLength:17,allowBlank:!1},{name:"macCustom",mapping:"mac_custom",vtype:"mac",maxLength:17,allowBlank:!1},{name:"macComputer",mapping:"mac_computer",vtype:"mac",maxLength:17,allowBlank:!1}],proxy:{url:$.su.url("/admin/network?form=mac_clone_advanced")}}),jQuery.su.moduleManager.define("internetNatAndWan",{services:[],models:["natModel","internetPortModel"],stores:["portSpeedStore"],views:["internetNatAndWanView"],deps:[],listeners:{"ev_on_launch":function(e,n,t,a,o,i,s){a.natModel.load(),a.internetPortModel.load(),o.portSpeedStore.load()}},init:function(e,n,t,a,o,i){this.control({}),this.listen({})}},function(e,n,t,a,o,i){return{submit:function(e){t.natModel.isDirty()&&t.natModel.submit(),t.internetPortModel.isDirty()&&t.internetPortModel.submit(),e&&e()}}}),$.su.modelManager.define("natModel",{fields:[{name:"enable",mapping:"enable"},{name:"boostEnable",mapping:"boost_enable"}],proxy:{url:$.su.url("/admin/nat?form=setting")}}),$.su.modelManager.define("internetPortModel",{fields:[{name:"speed",mapping:"speed"}],proxy:{url:$.su.url("/admin/network?form=port_speed_current")}}),$.su.storeManager.define("portSpeedStore",{type:"store",fields:[{name:"name"},{name:"value"}],convert:function(e){e=e.supported;for(var n=[],t=0;t<e.length;t++){var a={};a.value=e[t],a.name=o(e[t]),n.push(a)}function o(e){var n="";return e?"auto"==e?$.su.CHAR.NETWORK_INTERNET.AUTO_NEGOTIATION:(0<e.indexOf("H")?n=parseInt(e)+$.su.CHAR.NETWORK_INTERNET.HALF_DUPLEX:0<e.indexOf("F")&&(n=parseInt(e)+$.su.CHAR.NETWORK_INTERNET.FULL_DUPLEX),n):""}return n},proxy:{url:$.su.url("/admin/network?form=port_speed_supported")}}),function(p){p.su.moduleManager.define("internetPortConfig",{services:["ajax"],deps:["main"],models:["portModel"],stores:["portTypeStore"],views:["internetPortConfigView"],listeners:{"ev_on_launch":function(e,n,t,a,o,i,s){a.portModel.load(),t.internetPortConfigView.portMsg.hide()}},init:function(t,e,n,a,o,i){this.control({"#port-msg":{"ev_msg_ok":function(e,n){t.checkPhysicalConn(function(e){e?t.vdfd&&t.vdfd.resolve(!0):n.preventDefault()})},"ev_msg_no":function(e,n){t.vdfd&&t.vdfd.reject()},"ev_msg_close":function(){t.vdfd&&t.vdfd.reject()}}})}},function(o,t,a,e,i,s){var r=!1;return{vdfd:null,getCurrentPort:function(){return a.portModel.wanPortStatus.getValue()},validatePort:function(){return o.vdfd=p.Deferred(),a.portModel.isDirty()?(o.checkPhysicalConn(function(e){e?o.vdfd.resolve(!0):t.internetPortConfigView.portMsg.show()}),o.vdfd):o.vdfd.resolve(!1)},afterSubmitPort:function(){s.ajax.request({proxy:"portProxy",success:function(e){e.wan_port_status!==o.getCurrentPort()&&i.main.showNotice(p.su.CHAR.COMMON.SAVE_FAILED)}})},submitPort:function(){var e=p.Deferred();return a.portModel.submit({success:function(){e.resolve()},fail:e.reject,error:e.reject}),e},submit:function(n){if(!a.portModel.isDirty())return!1;o.checkPhysicalConn(function(e){if(e){n&&t.internetPortConfigView.portMsg.hide();a.portModel.submit({success:function(){t.internetPortConfigView.portRebootMsg.show(function(){t.internetPortConfigView.portRebootProgress.animate({duration:15e3,percentageStart:0,percentageEnd:100,callback:function(){t.internetPortConfigView.portRebootMsg.hide(),s.ajax.request({proxy:"portProxy",success:function(e){e.wan_port_status!==o.getCurrentPort()&&i.main.showNotice(p.su.CHAR.COMMON.SAVE_FAILED)}})}})})}})}else!n&&t.internetPortConfigView.portMsg.show()})},checkPhysicalConn:function(n){s.ajax.request({proxy:"portStatusProxy",success:function(e){var t="2500WAN"===o.getCurrentPort()?1:2,a=!1;p.map(e,function(e){for(key in e)if(/wan/.test(key)&&/\d/.test(key)){var n=parseInt(/\d/.exec(key)[0]);t===n&&/status/.test(key)&&(a="CONNECTED"===e[key].toUpperCase())}}),r=a,n&&n(r)},fail:function(){r=!1,n&&n(!1)},error:function(){r=!1,n&&n(!1)}})}}})}(jQuery),$.su.modelManager.define("portModel",{type:"model",fields:[{name:"wanPortStatus",mapping:"wan_port_status"}],proxy:{url:$.su.url("/admin/network?form=wan_port_status")}}),$.su.define("portProxy",{extend:"IPFProxy",url:$.su.url("/admin/network?form=wan_port_status"),preventSuccessEvent:!0,writeFilter:function(e){return $.extend({operation:"read"},e)}}),$.su.storeManager.define("portTypeStore",{type:"store",fields:[{name:"value"},{name:"boxlabel"},{name:"customLabel"}],data:[{value:"2500WAN",boxlabel:$.su.CHAR.NETWORK_INTERNET.PORT_2500WAN,customLabel:".interface-radio-2500"},{value:"1000WAN",boxlabel:$.su.CHAR.NETWORK_INTERNET.PORT_1000WAN,customLabel:".interface-radio-1000"}]}),$.su.storeManager.define("portTypeWithIllStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}],data:[{name:$.su.CHAR.NETWORK_INTERNET.PORT_2500WAN,value:"2500WAN",boxlabel:$.su.CHAR.NETWORK_INTERNET.PORT_2500WAN},{name:$.su.CHAR.NETWORK_INTERNET.PORT_1000WAN,value:"1000WAN",boxlabel:$.su.CHAR.NETWORK_INTERNET.PORT_1000WAN}]}),$.su.define("portStatusProxy",{extend:"IPFProxy",preventSuccessEvent:!0,url:$.su.url("/admin/status?form=router"),writeFilter:function(e){return $.extend({operation:"read"},e)}}),function(l){l.su.moduleManager.define("internetPPPOE",{services:["ajax","moduleManager","timer"],deps:["internet","utils"],stores:["internetIpAddressOptionStore","dnsAddressOptionStore","internetConnModeStore","setTimeHourStore","setTimeMinStore","pppoeSecondConnTypeStore","macCloneStore"],models:["pppoeModel","pppoeControlModel","ipv4Status","quickSetupModel"],views:["internetPPPOEView","internetPPPOEViewBasic","internetPPPOEViewQs"],listeners:{"ev_on_launch":function(e,t,n,i,a,o,s){t.unRegisterAutoSaveData([i.ipv4Status]),this.control({"#pppoe-renew-btn":{"ev_button_click":function(){n.internetPPPOEView.pppoeRenewStatus.hide(),i.pppoeControlModel.renewBtn.loading(!0),i.pppoeModel.load({data:{operation:"renew"},success:function(e){i.pppoeControlModel.renewBtn.loading(!1),n.internetPPPOEView.pppoeRenewStatus.show(),n.internetPPPOEView.pppoeRenewStatus.setSuccess(l.su.CHAR.NETWORK_INTERNET.SUCCESS),setTimeout(function(){n.internetPPPOEView.pppoeRenewStatus.hide()},5e3),o.internet.changeButtonStatus(e.conn_status,i.pppoeControlModel.renewBtn,i.pppoeControlModel.releaseBtn)},fail:function(){i.pppoeControlModel.renewBtn.loading(!1),n.internetPPPOEView.pppoeRenewStatus.show(),n.internetPPPOEView.pppoeRenewStatus.setSuccess(l.su.CHAR.NETWORK_INTERNET.FAILED),setTimeout(function(){n.internetPPPOEView.pppoeRenewStatus.hide()},5e3)},error:function(){i.pppoeControlModel.renewBtn.loading(!1),n.internetPPPOEView.pppoeRenewStatus.show(),n.internetPPPOEView.pppoeRenewStatus.setSuccess(l.su.CHAR.NETWORK_INTERNET.FAILED),setTimeout(function(){n.internetPPPOEView.pppoeRenewStatus.hide()},5e3)}})}},"#pppoe-release-btn":{"ev_button_click":function(){n.internetPPPOEView.pppoeReleaseStatus.hide(),i.pppoeControlModel.releaseBtn.loading(!0),i.pppoeModel.load({data:{operation:"release"},success:function(e){i.pppoeControlModel.releaseBtn.loading(!1),n.internetPPPOEView.pppoeReleaseStatus.show(),n.internetPPPOEView.pppoeReleaseStatus.setSuccess(l.su.CHAR.NETWORK_INTERNET.SUCCESS),setTimeout(function(){n.internetPPPOEView.pppoeReleaseStatus.hide()},5e3),o.internet.changeButtonStatus(e.conn_status,i.pppoeControlModel.renewBtn,i.pppoeControlModel.releaseBtn)},fail:function(){i.pppoeControlModel.releaseBtn.loading(!1),n.internetPPPOEView.pppoeReleaseStatus.show(),n.internetPPPOEView.pppoeReleaseStatus.setSuccess(l.su.CHAR.NETWORK_INTERNET.FAILED),setTimeout(function(){n.internetPPPOEView.pppoeReleaseStatus.hide()},5e3)},error:function(){i.pppoeControlModel.releaseBtn.loading(!1),n.internetPPPOEView.pppoeReleaseStatus.show(),n.internetPPPOEView.pppoeReleaseStatus.setSuccess(l.su.CHAR.NETWORK_INTERNET.FAILED),setTimeout(function(){n.internetPPPOEView.pppoeReleaseStatus.hide()},5e3)}})}},"#pppoe-connect-btn":{"ev_button_click":function(){i.pppoeModel.validate()&&i.pppoeControlModel.connBtn.loading(!0),t.submitDial({data:{operation:"connect"},success:function(){i.pppoeControlModel.connBtn.loading(!1)},fail:function(){i.pppoeControlModel.connBtn.loading(!1)},error:function(){i.pppoeControlModel.connBtn.loading(!1)}})}},"#pppoe-disconnect-btn":{"ev_button_click":function(){i.pppoeModel.validate()&&i.pppoeControlModel.disConnBtn.loading(!0),t.submitDial({data:{operation:"disconnect"},success:function(){i.pppoeControlModel.disConnBtn.loading(!1)},fail:function(){i.pppoeControlModel.disConnBtn.loading(!1)},error:function(){i.pppoeControlModel.disConnBtn.loading(!1)}})}},"#pppoe-advanced-panel":{"ev_panel_open":function(){t.initPPPoeAdv(!0),o.internet.changeButtonStatus(i.pppoeModel.connStatus.getValue(),i.pppoeControlModel.renewBtn,i.pppoeControlModel.releaseBtn),t.updateBtnStatus(i.pppoeModel.connStatus.getValue())},"ev_panel_close":function(){t.initPPPoeAdv(!1)}},"#qs-check-username-and-pwd-msg":{"ev_msg_ok":function(){s.moduleManager.get("quickSetup").goTo("qsWirelessSetting")}}}),this.listen({"models.pppoeModel.ipMode":{"ev_value_change":function(e,n){t.initIpMode()}},"models.pppoeModel.dnsMode":{"ev_value_change":function(e,n){t.initDnsMode()}},"models.pppoeModel.connMode":{"ev_value_change":function(e,n){t.initConnMode()}},"models.pppoeModel.sndConn":{"ev_value_change":function(e,n){t.initSndConn()}},"models.ipv4Status.conntype":{"ev_value_change":function(e,n){"pppoe"===n&&"pppoe"===o.internet.dutConnType?t.startRefreshInterval():t.stopRefreshInterval()}},"models.pppoeModel.connStatus":{"ev_value_change":function(e,n){t.updateBtnStatus(n),o.internet.changeButtonStatus(n,i.pppoeControlModel.renewBtn,i.pppoeControlModel.releaseBtn)}},"models.pppoeModel":{"ev_loaded":function(){t.updateConnTimePrompt()}},"models.pppoeModel.timeStart":{"ev_value_change":function(e,n){var t=n,a=i.pppoeModel.timeEnd.getValue();if("string"==typeof t&&"string"==typeof a){var o=parseInt(t.replace(":",""),10);parseInt(a.replace(":",""),10)<=o&&i.pppoeModel.timeEnd.setError(l.su.CHAR.ERROR["00000061"])}}},"models.pppoeModel.timeEnd":{"ev_value_change":function(e,n){var t=i.pppoeModel.timeStart.getValue(),a=n;if("string"==typeof t&&"string"==typeof a){var o=parseInt(t.replace(":",""),10);parseInt(a.replace(":",""),10)<=o&&i.pppoeModel.timeEnd.setError(l.su.CHAR.ERROR["00000061"])}}}}),i.pppoeModel.load({success:function(e){i.pppoeModel.conntype.setValue("pppoe"),o.internet.changeButtonStatus(e.conn_status,i.pppoeControlModel.renewBtn,i.pppoeControlModel.releaseBtn)}}),"pppoe"===i.ipv4Status.conntype.getValue()&&"pppoe"===o.internet.dutConnType&&t.startRefreshInterval()},"ev_before_destroy":function(){this.beforeDestroy()}}},function(a,r,p,e,d,o){var n,i=function(e){return null===e||e===undefined||""===e};return{validate:function(){if(r.internetPPPOEView.pppoeAdvPanel.isOpen()&&"time_based"==p.pppoeModel.connMode.getValue()){var e=p.pppoeModel.timeStart.getValue(),n=p.pppoeModel.timeEnd.getValue(),t=parseInt(e.replace(":",""),10);if(parseInt(n.replace(":",""),10)<=t)return p.pppoeModel.timeEnd.setError(l.su.CHAR.ERROR["00000061"]),!1}if("static"!==p.pppoeModel.sndConn.getValue())return!0;var a=p.pppoeModel.staticIp.getValue(),o=p.pppoeModel.staticNetmask.getValue(),i=d.internet.getLanIP(),s=d.internet.getLanMask();return d.utils.isNetIpLegal(a,o)?d.utils.isNetIp(a,o)||d.utils.isBroadCastIp(a,o)?(p.pppoeModel.staticIp.setError(),p.pppoeModel.staticNetmask.setError(l.su.CHAR.ERROR["00000150"]),!1):!d.utils.isSameNet(i,a,o)&&!d.utils.isSameNet(a,i,s)||(p.pppoeModel.staticIp.setError(),p.pppoeModel.staticNetmask.setError(l.su.CHAR.ERROR["00000060"]),!1):(p.pppoeModel.staticIp.setError(),p.pppoeModel.staticNetmask.setError(l.su.CHAR.ERROR["00000150"]),!1)},validateDial:function(){var e=p.pppoeModel,n=l.Deferred();if(!e.isDirty())return n.resolve(!1);if(1!=e.validate()||!a.validate())return n.reject();if(i(e.username.getValue())||i(e.password.getValue())){var t=o.moduleManager.get("main");t&&t.confirm(l.su.CHAR.NETWORK_INTERNET.BLANK_USERNAME_PWD_PROMPT,function(){n.resolve(!0)},function(){n.reject()},l.su.CHAR.OPERATION.OK)}else n.resolve(!0);return n.promise()},submit:function(){a.submitDial({success:function(){a.startRefreshInterval()}})},submitDial:function(e){var n=p.pppoeModel.conntype.getBackup(),t=e.success;e.success=function(e){d.internet.afterSubmitDial(n,"pppoe"),t&&t(e)},p.pppoeModel.submit(e)},updateBtnStatus:function(e){switch(e.toUpperCase()){case"CONNECTED":p.pppoeControlModel.connBtn.disable(),p.pppoeControlModel.disConnBtn.enable();break;case"DISCONNECTED":p.pppoeControlModel.connBtn.enable(),p.pppoeControlModel.disConnBtn.disable();break;case"CONNECTING":case"DISCONNECTING":p.pppoeControlModel.connBtn.enable(),p.pppoeControlModel.disConnBtn.enable()}},updateConnTimePrompt:function(){var e=p.pppoeModel.timeStart.getValue(),n=p.pppoeModel.timeEnd.getValue();"time_based"!==p.pppoeModel.connMode.getValue()?(p.pppoeControlModel.connectPrompt.hide(),p.pppoeControlModel.disConnectPrompt.hide()):(p.pppoeControlModel.connectPrompt.setText(l.su.CHAR.NETWORK_INTERNET.NEXT_CONN_TIME.replace("%TIME%",e)),p.pppoeControlModel.disConnectPrompt.setText(l.su.CHAR.NETWORK_INTERNET.NEXT_DISCONN_TIME.replace("%TIME%",n)),p.pppoeControlModel.connectPrompt.show(),p.pppoeControlModel.disConnectPrompt.show())},refreshData:function(){o.ajax.request({proxy:"pppoeRefreshProxy",data:{operation:"read",share:d.internet.getShareflag()},success:function(e){var n=e.data,t=d.internet.getShareflag();d.internet.trigger("ev_conn_from_data_loaded",[n]),t!=d.internet.getShareflag()&&a.refreshData(),"pppoe"===n.connType?(p.pppoeModel.replaceData(n,!1,!0),a.updateBtnStatus(n.connStatus),d.internet.changeButtonStatus(n.connStatus,p.pppoeControlModel.renewBtn,p.pppoeControlModel.releaseBtn)):a.stopRefreshInterval()}})},startRefreshInterval:function(){"internetPPPOEView"===this.getEffectiveView()&&(clearInterval(n),n=o.timer.setInterval(a,function(){a.refreshData()},d.internet.pollingInterval,!0))},stopRefreshInterval:function(){clearInterval(n)},beforeDestroy:function(){p.pppoeModel.reset(),this.unRegisterAutoSaveData(p.pppoeModel),a.stopRefreshInterval()},syncQsData:function(){if("internetPPPOEViewQs"===this.getEffectiveView()&&(i(p.pppoeModel.username.getValue())||i(p.pppoeModel.password.getValue())))return r.internetPPPOEViewQs.checkUsernameAndPwdMsg.show(),r.internetPPPOEViewQs.checkUsernameAndPwdPromptText.setText(l.su.CHAR.NETWORK_INTERNET.BLANK_USERNAME_PWD_PROMPT),!1;if(!p.pppoeModel.validate())return!1;var e=p.pppoeModel.getData();return p.quickSetupModel.replaceData({networkDhcpMacCloneType:"default",networkPppoeUsername:e.username,networkPppoePassword:e.password}),!0},initSndConn:function(){if("internetPPPOEView"===this.getEffectiveView())switch(p.pppoeModel.sndConn.getValue()){case"static":p.pppoeModel.staticIp.show(),p.pppoeModel.staticIp.enable(),p.pppoeModel.staticNetmask.show(),p.pppoeModel.staticNetmask.enable(),p.pppoeModel.dynIp.hide(),p.pppoeModel.dynIp.disable(),p.pppoeModel.dynNetmask.hide(),p.pppoeModel.dynNetmask.disable(),p.pppoeControlModel.renewBtn.hide(),p.pppoeControlModel.releaseBtn.hide();break;case"dynamic":p.pppoeModel.dynIp.show(),p.pppoeModel.dynIp.enable(),p.pppoeModel.dynNetmask.show(),p.pppoeModel.dynNetmask.enable(),p.pppoeModel.staticIp.hide(),p.pppoeModel.staticIp.disable(),p.pppoeModel.staticNetmask.hide(),p.pppoeModel.staticNetmask.disable(),p.pppoeControlModel.renewBtn.show(),p.pppoeControlModel.releaseBtn.show();break;default:p.pppoeModel.staticIp.hide(),p.pppoeModel.staticIp.disable(),p.pppoeModel.staticNetmask.hide(),p.pppoeModel.staticNetmask.disable(),p.pppoeModel.dynIp.hide(),p.pppoeModel.dynIp.disable(),p.pppoeModel.dynNetmask.hide(),p.pppoeModel.dynNetmask.disable(),p.pppoeControlModel.renewBtn.hide(),p.pppoeControlModel.releaseBtn.hide()}else switch(p.pppoeModel.sndConn.getValue()){case"static":p.pppoeModel.staticIp.enable(),p.pppoeModel.staticNetmask.enable(),p.pppoeModel.dynIp.disable(),p.pppoeModel.dynNetmask.disable();break;case"dynamic":p.pppoeModel.dynIp.enable(),p.pppoeModel.dynNetmask.enable(),p.pppoeModel.staticIp.disable(),p.pppoeModel.staticNetmask.disable();break;default:p.pppoeModel.staticIp.disable(),p.pppoeModel.staticNetmask.disable(),p.pppoeModel.dynIp.disable(),p.pppoeModel.dynNetmask.disable()}},initIpMode:function(){if("internetPPPOEView"===this.getEffectiveView())switch(p.pppoeModel.ipMode.getValue()){case"dynamic":p.pppoeModel.specificIp.hide(),p.pppoeModel.specificIp.disable();break;case"static":p.pppoeModel.specificIp.show(),p.pppoeModel.specificIp.enable()}else p.pppoeModel.specificIp.disable()},initDnsMode:function(){if("internetPPPOEView"===this.getEffectiveView())switch(p.pppoeModel.dnsMode.getValue()){case"dynamic":p.pppoeModel.dynPridns.show(),p.pppoeModel.dynSnddns.show(),p.pppoeModel.staticPridns.hide(),p.pppoeModel.staticSnddns.hide(),p.pppoeModel.staticPridns.disable(),p.pppoeModel.staticSnddns.disable();break;case"static":p.pppoeModel.staticPridns.show(),p.pppoeModel.staticSnddns.show(),p.pppoeModel.staticPridns.enable(),p.pppoeModel.staticSnddns.enable(),p.pppoeModel.dynPridns.hide(),p.pppoeModel.dynSnddns.hide()}else p.pppoeModel.staticPridns.disable(),p.pppoeModel.staticSnddns.disable(),"internetPPPOEViewBasic"===this.getEffectiveView()&&"static"==p.pppoeModel.dnsMode.getValue()&&(p.pppoeModel.staticPridns.enable(),p.pppoeModel.staticSnddns.enable())},initConnMode:function(){if(p.pppoeModel.demandIdle.hide(),p.pppoeModel.manualIdle.hide(),p.pppoeControlModel.periodContainer.hide(),p.pppoeModel.connMode.setTips(""),"internetPPPOEView"===this.getEffectiveView())switch(p.pppoeModel.connMode.getValue()){case"demand":p.pppoeModel.demandIdle.enable(),p.pppoeModel.demandIdle.show(),p.pppoeModel.connMode.setTips(l.su.CHAR.NETWORK_INTERNET.CONN_TYPE_TIPS);break;case"time_based":p.pppoeControlModel.periodContainer.show();break;case"manually":p.pppoeModel.manualIdle.enable(),p.pppoeModel.manualIdle.show(),p.pppoeModel.connMode.setTips(l.su.CHAR.NETWORK_INTERNET.MANUAL_TIPS)}else p.pppoeModel.demandIdle.disable(),p.pppoeModel.manualIdle.disable(),p.pppoeControlModel.periodContainer.hide()},initPPPoeAdv:function(e){e?(r.internetPPPOEView.pppoeAdvSetting.show(),a.initSndConn(),a.initIpMode(),a.initDnsMode(),a.initConnMode()):r.internetPPPOEView.pppoeAdvSetting.hide()}}})}(jQuery),$.su.modelManager.define("pppoeModel",{fields:[{name:"conntype",mapping:"conntype"},{name:"username",mapping:"username",vtype:"string_visible_allow_blank",maxLength:255,minLength:0},{name:"password",mapping:"password",vtype:"password",maxLength:255,minLength:0},{name:"inetIp",mapping:"inet_ip"},{name:"inetPridns",mapping:"inet_pridns"},{name:"inetSnddns",mapping:"inet_snddns"},{name:"sndConn",mapping:"snd_conn"},{name:"dynIp",mapping:"dyn_ip"},{name:"dynNetmask",mapping:"dyn_netmask"},{name:"staticIp",mapping:"static_ip",vtype:"ip",allowBlank:!1},{name:"staticNetmask",mapping:"static_netmask",allowBlank:!1,vtype:"netmask"},{name:"mtu",mapping:"mtu",allowBlank:!1,valueType:"number",maxLength:4,vtype:{vtype:"number",max:1492,min:576,minMaxText:$.su.CHAR.NETWORK_INTERNET.VALUE_TIPS+" "+$.su.CHAR.NETWORK_INTERNET.VALUE_DEFAULT+"1480."}},{name:"server",mapping:"server",maxLength:31,minLength:0,vtype:"string_visible_allow_blank"},{name:"access",mapping:"access",vtype:"string_visible_allow_blank",maxLength:31,minLength:0},{name:"interval",mapping:"interval",allowBlank:!1,maxLength:3,valueType:"number",vtype:{vtype:"number",max:120,min:0,minMaxText:$.su.CHAR.NETWORK_INTERNET.VALUE_TIPS+" "+$.su.CHAR.NETWORK_INTERNET.VALUE_DEFAULT+"10."}},{name:"ipMode",mapping:"ip_mode"},{name:"specificIp",mapping:"specific_ip",allowBlank:!1,vtype:"ip"},{name:"dnsMode",mapping:"dns_mode"},{name:"dynPridns",mapping:"dyn_pridns"},{name:"dynSnddns",mapping:"dyn_snddns"},{name:"staticPridns",mapping:"static_pridns",allowBlank:!1,vtype:"ip"},{name:"staticSnddns",mapping:"static_snddns",vtype:"ip"},{name:"connMode",mapping:"conn_mode"},{name:"demandIdle",mapping:"demand_idle",allowBlank:!1,maxLength:2,vtype:{vtype:"number",max:99,min:0}},{name:"timeStart",mapping:"time_start"},{name:"timeEnd",mapping:"time_end"},{name:"manualIdle",mapping:"manual_idle",allowBlank:!1,valueType:"number",maxLength:2,vtype:{vtype:"number",max:99,min:0}},{name:"connStatus",mapping:"conn_status"}],proxy:{url:$.su.url("/admin/network?form=wan_ipv4_pppoe")}}),$.su.modelManager.define("pppoeControlModel",{fields:[{name:"checkUsernameAndPwdMsg"},{name:"periodContainer"},{name:"renewBtn"},{name:"releaseBtn"},{name:"connBtn"},{name:"disConnBtn"},{name:"connBtnAndPrompt"},{name:"disConnBtnAndPrompt"},{name:"connectPrompt"},{name:"disConnectPrompt"},{name:"checkUsernameAndPwdPromptText"}]}),$.su.storeManager.define("internetIpAddressOptionStore",{type:"store",fields:[{name:"value"},{name:"name"}],data:[{value:"dynamic",name:$.su.CHAR.NETWORK_INTERNET.DNS_ADDRESS_AUTO},{value:"static",name:$.su.CHAR.NETWORK_INTERNET.IP_ADDRESS_MANUAL}]}),$.su.storeManager.define("internetConnModeStore",{type:"store",fields:[{name:"value"},{name:"name"}],data:[{value:"auto",name:$.su.CHAR.NETWORK_INTERNET.AUTO},{value:"demand",name:$.su.CHAR.NETWORK_INTERNET.ON_DEMAND},{value:"time_based",name:$.su.CHAR.NETWORK_INTERNET.TIME_BASED},{value:"manually",name:$.su.CHAR.NETWORK_INTERNET.MANUAL}]}),$.su.storeManager.define("pppoeSecondConnTypeStore",{type:"store",fields:[{name:"value"},{name:"name"}],data:[{value:"none",name:$.su.CHAR.NETWORK_INTERNET.NONE},{value:"dynamic",name:$.su.CHAR.NETWORK_INTERNET.DYNAMIC},{value:"static",name:$.su.CHAR.NETWORK_INTERNET.STATIC}]}),$.su.define("pppoeRefreshProxy",{extend:"IPFProxy",url:$.su.url("/admin/network?form=wan_ipv4_pppoe"),readFilter:function(e){return{data:{pppshare:(e=e.data).pppshare,connType:e.conntype,connStatus:e.conn_status,inetIp:e.inet_ip,inetPridns:e.inet_pridns,inetSnddns:e.inet_snddns,dynIp:e.dyn_ip,dynNetmask:e.dyn_netmask,dynGateway:e.dyn_gateway,dynPridns:e.dyn_pridns,dynSnddns:e.dyn_snddns}}},writeFilter:function(e){return{share:e.share,operation:"read"}}}),function(u){u.su.moduleManager.define("internetPPTP",{services:["vtype","ajax","moduleManager","timer"],stores:["pptpIpTypeStore","internetConnModeStore2"],views:["internetPPTPView","internetPPTPViewBasic","internetPPTPViewQs"],deps:["utils","internet"],models:["pptpModel","pptpControlModel","ipv4Status","quickSetupModel"],listeners:{"ev_on_launch":function(e,t,n,i,a,o,s){t.unRegisterAutoSaveData([i.ipv4Status]),this.control({"#pptp-conn-btn":{"ev_button_click":function(){i.pptpModel.validate()&&i.pptpControlModel.connBtn.loading(!0),t.submitDial({data:{operation:"connect"},success:function(e){i.pptpControlModel.connBtn.loading(!1),o.internet.changeButtonStatus(e.connStatus,i.pptpControlModel.connBtn,i.pptpControlModel.disConnBtn)},fail:function(){i.pptpControlModel.connBtn.loading(!1)},error:function(){i.pptpControlModel.connBtn.loading(!1)}})}},"#pptp-disconn-btn":{"ev_button_click":function(){i.pptpModel.validate()&&i.pptpControlModel.disConnBtn.loading(!0),t.submitDial({data:{operation:"disconnect"},success:function(e){i.pptpControlModel.disConnBtn.loading(!1),o.internet.changeButtonStatus(e.connStatus,i.pptpControlModel.connBtn,i.pptpControlModel.disConnBtn)},fail:function(){i.pptpControlModel.disConnBtn.loading(!1)},error:function(){i.pptpControlModel.disConnBtn.loading(!1)}})}},"#qs-check-username-and-pwd-msg":{"ev_msg_ok":function(){t.syncQsDfd.resolve()}}}),this.listen({"models.pptpModel.sndConn":{"ev_value_change":function(e,n){switch(n){case"static":i.pptpControlModel.staticEditField.show(),i.pptpControlModel.dynamicEditField.hide();break;default:i.pptpControlModel.staticEditField.hide(),i.pptpControlModel.dynamicEditField.show()}}},"models.pptpModel.connMode":{"ev_value_change":function(e,n){if(i.pptpModel.demandIdle.hide(),i.pptpModel.manualIdle.hide(),i.pptpControlModel.periodContainer.hide(),i.pptpModel.connMode.setTips(""),"internetPPTPView"===this.getEffectiveView())switch(n){case"demand":i.pptpModel.demandIdle.enable(),i.pptpModel.demandIdle.show(),i.pptpModel.connMode.setTips(u.su.CHAR.NETWORK_INTERNET.CONN_TYPE_TIPS);break;case"time_based":i.pptpControlModel.periodContainer.enable(),i.pptpControlModel.periodContainer.show();break;case"manually":i.pptpModel.manualIdle.enable(),i.pptpModel.manualIdle.show(),i.pptpModel.connMode.setTips(u.su.CHAR.NETWORK_INTERNET.MANUAL_TIPS)}else i.pptpModel.demandIdle.disable(),i.pptpModel.manualIdle.disable(),i.pptpControlModel.periodContainer.hide()}},"models.ipv4Status.conntype":{"ev_value_change":function(e,n){"pptp"===n&&"pptp"===o.internet.dutConnType?t.startRefreshInterval():t.stopRefreshInterval()}},"models.pptpModel.timeStart":{"ev_value_change":function(e,n){var t=n,a=i.pptpModel.timeEnd.getValue();if("string"==typeof t&&"string"==typeof a){var o=parseInt(t.replace(":",""),10);parseInt(a.replace(":",""),10)<=o?i.pptpModel.timeEnd.setShortTips(u.su.CHAR.NETWORK_INTERNET.NEXT_DAY_TIP):i.pptpModel.timeEnd.setShortTips("&nbsp;")}}},"models.pptpModel.timeEnd":{"ev_value_change":function(e,n){var t=i.pptpModel.timeStart.getValue(),a=n;if("string"==typeof t&&"string"==typeof a){var o=parseInt(t.replace(":",""),10);parseInt(a.replace(":",""),10)<=o?i.pptpModel.timeEnd.setShortTips(u.su.CHAR.NETWORK_INTERNET.NEXT_DAY_TIP):i.pptpModel.timeEnd.setShortTips("&nbsp;")}}}}),i.pptpModel.load({success:function(e){i.pptpModel.conntype.setValue("pptp"),o.internet.changeButtonStatus(e.conn_status,i.pptpControlModel.connBtn,i.pptpControlModel.disConnBtn)}}),"pptp"===i.ipv4Status.conntype.getValue()&&"pptp"===o.internet.dutConnType&&t.startRefreshInterval()},"ev_before_destroy":function(){this.beforeDestroy()}}},function(a,n,p,e,d,l){var t,o=function(e){return null===e||e===undefined||""===e};return{validate:function(){if("dynamic"===p.pptpModel.sndConn.getValue())return!0;var e=p.pptpModel.staticIp.getValue(),n=p.pptpModel.staticNetmask.getValue(),t=p.pptpModel.staticGateway.getValue(),a=p.pptpModel.staticServer.getValue(),o=p.pptpModel.staticPridns.getValue(),i=d.internet.getLanIP(),s=d.internet.getLanMask(),r=l.vtype;if(""!=a&&1==r.validate(a,"ip")&&!d.utils.isSameNet(a,e,n)&&""==t)return p.pptpModel.staticGateway.setError(u.su.CHAR.ERROR["00000062"]),!1;if(""!=a&&1!=r.validate(a,"ip")){if(!d.utils.isSameNet(o,e,n)&&""==t)return p.pptpModel.staticGateway.setError(u.su.CHAR.ERROR["00000062"]),!1;if(""==o)return p.pptpModel.staticPridns.setError(u.su.CHAR.ERROR["00000062"]),!1}return d.utils.isNetIpLegal(e,n)?d.utils.isNetIp(e,n)||d.utils.isBroadCastIp(e,n)?(p.pptpModel.staticIp.setError(),p.pptpModel.staticNetmask.setError(u.su.CHAR.ERROR["00000150"]),!1):!d.utils.isSameNet(i,e,n)&&!d.utils.isSameNet(e,i,s)||(p.pptpModel.staticIp.setError(),p.pptpModel.staticNetmask.setError(u.su.CHAR.ERROR["00000060"]),!1):(p.pptpModel.staticIp.setError(),p.pptpModel.staticNetmask.setError(u.su.CHAR.ERROR["00000150"]),!1)},validateDial:function(){var e=p.pptpModel,n=u.Deferred();if(!e.isDirty())return n.resolve(!1);if(1!=e.validate()||!a.validate())return n.reject();if(o(e.username.getValue())||o(e.password.getValue())){var t=l.moduleManager.get("main");t&&t.confirm(u.su.CHAR.NETWORK_INTERNET.BLANK_USERNAME_PWD_PROMPT,function(){n.resolve(!0)},function(){n.reject()},u.su.CHAR.OPERATION.OK)}else n.resolve(!0);return n.promise()},submit:function(){a.submitDial({success:function(){a.startRefreshInterval()}})},submitDial:function(e){var n=p.pptpModel.conntype.getBackup(),t=e.success;e.success=function(e){d.internet.afterSubmitDial(n,"pptp"),t&&t(e)},p.pptpModel.submit(e)},refreshData:function(){l.ajax.request({proxy:"pptpRefreshProxy",data:{operation:"read",share:d.internet.getShareflag()},success:function(e){var n=e.data,t=d.internet.getShareflag();d.internet.trigger("ev_conn_from_data_loaded",[n]),t!=d.internet.getShareflag()&&a.refreshData(),"pptp"===n.connType?(p.pptpModel.replaceData(n,!1,!0),d.internet.changeButtonStatus(n.connStatus,p.pptpControlModel.connBtn,p.pptpControlModel.disConnBtn)):a.stopRefreshInterval()}})},startRefreshInterval:function(){"internetPPTPView"===this.getEffectiveView()&&(clearInterval(t),t=l.timer.setInterval(a,function(){a.refreshData()},d.internet.pollingInterval,!0))},stopRefreshInterval:function(){clearInterval(t)},beforeDestroy:function(){p.pptpModel.reset(),this.unRegisterAutoSaveData(p.pptpModel),a.stopRefreshInterval()},syncQsData:function(){var e=p.pptpModel.getData();return!(!p.pptpModel.validate()||!a.validate())&&(p.quickSetupModel.replaceData({networkDhcpMacCloneType:"default",networkPptpUsername:e.username,networkPptpPassword:e.password,networkPptpSndConn:e.sndConn}),"dynamic"===e.sndConn?p.quickSetupModel.networkPptpDynServer.setValue(e.dynServer):p.quickSetupModel.replaceData({networkPptpStaticServer:e.staticServer,networkPptpStaticIp:e.staticIp,networkPptpStaticNetmask:e.staticNetmask,networkPptpStaticGateway:e.staticGateway,networkPptpStaticPridns:e.staticPridns,networkPptpStaticSnddns:e.staticSnddns}),!o(p.pptpModel.username.getValue())&&!o(p.pptpModel.password.getValue())||(n.internetPPTPViewQs.checkUsernameAndPwdMsg.show(),a.syncQsDfd=u.Deferred(),a.syncQsDfd))}}})}(jQuery),$.su.modelManager.define("pptpModel",{fields:[{name:"conntype",mapping:"conntype"},{name:"username",mapping:"username",maxLength:255,minLength:0,vtype:"string_visible_allow_blank"},{name:"password",mapping:"password",maxLength:255,minLength:0,vtype:"password"},{name:"inetIp",mapping:"inet_ip"},{name:"inetPridns",mapping:"inet_pridns"},{name:"inetSnddns",mapping:"inet_snddns"},{name:"sndConn",mapping:"snd_conn"},{name:"dynServer",mapping:"dyn_server",allowBlank:!1,maxLength:63,minLength:0,vtype:"string_ip_domain"},{name:"dynIp",mapping:"dyn_ip"},{name:"dynNetmask",mapping:"dyn_netmask"},{name:"dynGateway",mapping:"dyn_gateway"},{name:"dynPridns",mapping:"dyn_pridns"},{name:"dynSnddns",mapping:"dyn_snddns"},{name:"staticPridns",mapping:"static_pridns"},{name:"staticSnddns",mapping:"static_snddns"},{name:"staticServer",mapping:"static_server",allowBlank:!1,maxLength:63,minLength:0,vtype:"string_ip_domain"},{name:"staticIp",mapping:"static_ip",allowBlank:!1,vtype:"ip"},{name:"staticNetmask",mapping:"static_netmask",allowBlank:!1,vtype:"netmask"},{name:"staticGateway",mapping:"static_gateway",vtype:"ip"},{name:"staticPridns",mapping:"static_pridns",vtype:"ip"},{name:"staticSnddns",mapping:"static_snddns",vtype:"ip"},{name:"mtu",mapping:"mtu",allowBlank:!1,valueType:"number",maxLength:4,vtype:{vtype:"number",max:1420,min:576,minMaxText:$.su.CHAR.NETWORK_INTERNET.VALUE_TIPS+" "+$.su.CHAR.NETWORK_INTERNET.VALUE_DEFAULT+"1420."}},{name:"connMode",mapping:"conn_mode"},{name:"demandIdle",mapping:"demand_idle",allowBlank:!1,valueType:"number",maxLength:2,vtype:{vtype:"number",max:99,min:0}},{name:"connStatus",mapping:"conn_status"},{name:"timeStart",mapping:"time_start"},{name:"timeEnd",mapping:"time_end"},{name:"manualIdle",mapping:"manual_idle",allowBlank:!1,valueType:"number",maxLength:2,vtype:{vtype:"number",max:99,min:0}}],proxy:{url:$.su.url("/admin/network?form=wan_ipv4_pptp")}}),$.su.modelManager.define("pptpControlModel",{fields:[{name:"connBtn"},{name:"disConnBtn"},{name:"staticEditField"},{name:"dynamicEditField"},{name:"checkUsernameAndPwdMsg"},{name:"periodContainer"}]}),$.su.storeManager.define("pptpIpTypeStore",{type:"store",fields:[{name:"value"},{name:"boxlabel"}],data:[{value:"dynamic",boxlabel:$.su.CHAR.NETWORK_INTERNET.DYNAMIC},{value:"static",boxlabel:$.su.CHAR.NETWORK_INTERNET.STATIC}]}),$.su.define("pptpRefreshProxy",{extend:"IPFProxy",url:$.su.url("/admin/network?form=wan_ipv4_pptp"),readFilter:function(e){return{data:{connStatus:(e=e.data).conn_status,pppshare:e.pppshare,connType:e.conntype,inetIp:e.inet_ip,inetPridns:e.inet_pridns,inetSnddns:e.inet_snddns,dynIp:e.dyn_ip,dynNetmask:e.dyn_netmask,dynGateway:e.dyn_gateway,dynPridns:e.dyn_pridns,dynSnddns:e.dyn_snddns}}},writeFilter:function(e){return{share:e.share,operation:"read"}}}),function(s){s.su.moduleManager.define("internetStaticIP",{services:[],deps:["utils","internet"],models:["staticIPModel","quickSetupModel","ipv4Status"],views:["internetStaticIPView","internetStaticIPViewBasic","internetStaticIPViewQs"],listeners:{"ev_on_launch":function(e,n,t,a,o,i,s){n.unRegisterAutoSaveData([a.ipv4Status]),this.control(),this.listen(),a.staticIPModel.load({success:function(){a.staticIPModel.conntype.setValue("static")}})},"ev_before_destroy":function(){this.beforeDestroy()}}},function(n,e,o,t,i,a){return{validateDial:function(){var e=s.Deferred();return o.staticIPModel.isDirty()?o.staticIPModel.validate()?e.resolve(!0):e.reject():e.resolve(!1)},submit:function(){var e=o.staticIPModel.conntype.getBackup();o.staticIPModel.submit({success:function(){i.internet.afterSubmitDial(e,"static")}})},validate:function(){var e=o.staticIPModel.ipaddr.getValue(),n=o.staticIPModel.netmask.getValue(),t=i.internet.getLanIP(),a=i.internet.getLanMask();return i.utils.isNetIpLegal(e,n)?i.utils.isNetIp(e,n)||i.utils.isBroadCastIp(e,n)?(o.staticIPModel.ipaddr.setError(),o.staticIPModel.netmask.setError(s.su.CHAR.ERROR["00000150"]),!1):!i.utils.isSameNet(t,e,n)&&!i.utils.isSameNet(e,t,a)||(o.staticIPModel.ipaddr.setError(),o.staticIPModel.netmask.setError(s.su.CHAR.ERROR["00000060"]),!1):(o.staticIPModel.ipaddr.setError(),o.staticIPModel.netmask.setError(s.su.CHAR.ERROR["00000150"]),!1)},syncQsData:function(){var e=o.staticIPModel.getData();return!(!o.staticIPModel.validate()||!n.validate())&&(o.quickSetupModel.replaceData({networkDhcpMacCloneType:"default",networkStaticIpaddr:e.ipaddr,networkStaticNetmask:e.netmask,networkStaticGateway:e.gateway,networkStaticPriDns:e.priDns,networkStaticSndDns:e.sndDns}),!0)},beforeDestroy:function(){o.staticIPModel.reset(),this.unRegisterAutoSaveData(o.staticIPModel)}}})}(jQuery),$.su.modelManager.define("staticIPModel",{fields:[{name:"conntype",mapping:"conntype"},{name:"ipaddr",mapping:"ipaddr",allowBlank:!1,vtype:"ip"},{name:"netmask",mapping:"netmask",allowBlank:!1,vtype:"netmask"},{name:"gateway",mapping:"gateway",allowBlank:!1,vtype:"ip"},{name:"priDns",mapping:"pri_dns",allowBlank:!1,vtype:"ip"},{name:"sndDns",mapping:"snd_dns",vtype:"ip"},{name:"connStatus",mapping:"conn_status"},{name:"mtu",mapping:"mtu",allowBlank:!1,valueType:"number",maxLength:4,vtype:{vtype:"number",max:1500,min:576,minMaxText:$.su.CHAR.NETWORK_INTERNET.VALUE_TIPS+" "+$.su.CHAR.NETWORK_INTERNET.VALUE_DEFAULT+"1500."}}],proxy:{url:$.su.url("/admin/network?form=wan_ipv4_staticip")}}),function(r){r.su.moduleManager.define("internetV6plus",{services:["moduleManager"],deps:["internet","index"],models:["V6plusModel","ipv4Status"],views:["internetV6plusView","internetV6plusViewBasic","internetV6plusViewQs"],listeners:{"ev_on_launch":function(e,n,t,a,o,i,s){n.unRegisterAutoSaveData([a.ipv4Status]),this.control(),this.listen(),a.V6plusModel.load({success:function(){a.V6plusModel.conntype.setValue("v6plus")}})},"ev_before_destroy":function(){this.beforeDestroy()}}},function(a,e,o,n,i,s){return{validateDial:function(){var e=o.V6plusModel,n=r.Deferred();if(!e.isDirty())return n.resolve(!1);var t=s.moduleManager.get("main");return t&&t.confirm(a.getUnavialModuleHtml(r.su.CHAR.NETWORK_INTERNET.V6_PLUS_WARNING),function(){n.resolve(!0)},function(){n.reject()},r.su.CHAR.OPERATION.OK),n.promise()},getUnavialModuleHtml:function(e){for(var n=s.moduleManager.get("navigatorController").getV6DsliteHiddenName(),t=0,a=n.length,o="";t<a;t++)o+="<p>"+n[t]+"</p>";return e+o},submit:function(){var e=o.V6plusModel,n=e.conntype.getBackup(),t=r.Deferred();return e.submit({ajax:{timeout:2e4},success:function(){i.internet.afterSubmitDial(n,"v6plus"),t.resolve()},fail:function(){t.reject()},error:function(){t.reject()}}),t.promise()},syncQsData:function(){return!0},beforeDestroy:function(){o.V6plusModel.reset(),this.unRegisterAutoSaveData(o.V6plusModel)}}})}(jQuery),$.su.modelManager.define("V6plusModel",{fields:[{name:"conntype"}],proxy:{url:$.su.url("/admin/network?form=wan_ipv4_v6plus")}});
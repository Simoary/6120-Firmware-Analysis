!function(s){s.su.moduleManager.define("main",{services:["moduleLoader","user","ajax","device"],stores:[],deps:[],views:["main"],listeners:{"ev_on_launch":function(o,i,e,n,a,t,r){location.hash&&location.hash.substr(1);i.syncTokenFromStorage(),s("#global-splash .outer").css("background-size","cover");setTimeout(function(){i.hideSplash()},600);if(r.device.getIsBeta()?s("body").addClass("beta"):s("body").removeClass("beta"),""===i.getToken())i.loadBasicModule("login");else{try{s.su.encryptor=s.encrypt.encryptManager.getEncryptor(),s.su.userInfo=localStorage.getItem("userInfo")?JSON.parse(localStorage.getItem("userInfo")):{}}catch(o){return void i.loadLoginPage()}r.ajax.request({proxy:"firmwareProxy",method:"read",success:function(o){var e="ap"===r.device.getCurrentMode()?"quickSetupAp":"quickSetup",n=o.upgraded,a=!1;i.upgraded=n,i.rebootTime=1e3*o.rebootTime,location.hash.substr(1)!==e?!0===o.isDefault?(location.href.indexOf(e)<0&&(location.href=location.href+"#"+e),i.loadBasicModule(e)):n?r.ajax.request({proxy:"checkInternetProxy",success:function(o){r.ajax.request({proxy:"cloudBindStatusProxy",method:"read",success:function(o){a=o.isbind,n&&!a?i.loadBasicModule(e):i.loadBasicModule("index",function(){r.ajax.request({proxy:"firmwareProxy",method:"write",data:{upgraded:!1}}),i.upgraded=!1})},fail:function(o){i.loadBasicModule("index",function(){r.ajax.request({proxy:"firmwareProxy",method:"write",data:{upgraded:!1}}),i.upgraded=!1})},error:function(o){i.loadBasicModule("index",function(){r.ajax.request({proxy:"firmwareProxy",method:"write",data:{upgraded:!1}}),i.upgraded=!1})}})},fail:function(o){i.loadBasicModule("index",function(){r.ajax.request({proxy:"firmwareProxy",method:"write",data:{upgraded:!1}}),i.upgraded=!1})},error:function(o){i.loadBasicModule("index",function(){r.ajax.request({proxy:"firmwareProxy",method:"write",data:{upgraded:!1}}),i.upgraded=!1})}}):i.loadBasicModule("index",function(){r.ajax.request({proxy:"firmwareProxy",method:"write",data:{upgraded:!1}}),i.upgraded=!1}):i.loadBasicModule(e)},fail:function(){i.loadBasicModule("login")},error:function(){i.loadBasicModule("login")}}),i.cloudInfo={},s.su.userInfo.token&&(i.cloudInfo.islogined=!0,i.cloudInfo.username=s.su.userInfo.username),r.ajax.request({proxy:"checkUpgradeNumberProxy",method:"read",success:function(o){var e=parseInt(o.updateNumber,10);i.showUpgradeHint=0<e}})}},"ev_login_timeout":function(){this.onLoginTimeout()},"ev_auto_upgrading":function(){this.onAutoUpgrading()},"ev_user_conflict":function(){this.onUserConflict()},"ev_permission_denied":function(){this.onPermissionDenied()}},init:function(n,o,e,a,i,t){this.control({"#global-confirm":{"ev_msg_ok":function(o,e){n.globalConfirmSuccessCallback&&n.globalConfirmSuccessCallback.call(null,e),n.globalConfirmSuccessCallback=null},"ev_msg_no":function(){n.globalConfirmFailCallback&&n.globalConfirmFailCallback.call(),n.globalConfirmFailCallback=null},"ev_msg_close":function(){n.globalConfirmFailCallback&&n.globalConfirmFailCallback.call(),n.globalConfirmFailCallback=null}},"#failure-retry-msg":{"ev_msg_ok":function(){s.su.moduleManager.get("firmware").failureRetry()}},"#upgrade-fail-alert":{"ev_msg_ok":function(){var o=s.su.moduleManager.get("qsInternetConnection");o&&o.proceedTpCloud()}}})}},function(t,r,o,e,n,a){t=this;return{LOGOUT_URL:s.su.url("/admin/system?form=logout"),FIRMWARE_URL:s.su.url("/admin/firmware?form=upgrade"),waitingId:!1,waitingTime:2e4,showUpgradeHint:!1,upgraded:!1,rebootTime:12e4,loadBasicModule:function(o,e){a.moduleLoader.load({module:"main"},{module:o},r.main.basicModuleLoader,e)},splashTime:1e3,showSplash:function(){r.main.splash.show()},hideSplash:function(){r.main.splash.fadeOut(400)},showError:function(o){o&&(r.main.globalError.setContent(o),r.main.globalError.show())},startReboot:function(o,e,n){o=o||9e4;var a=this;n?(r.main.rebootTips.show(),r.main.rebootTips.setText(n)):r.main.rebootTips.hide(),r.main.rebootMsg.show(function(){r.main.rebootProgress.animate({duration:o,percentageStart:0,percentageEnd:100,callback:function(){a.checkReboot(),e&&e()}})})},checkReboot:function(){r.main.rebootMsg.hide()},showNotice:function(o,e){r.main.globalNotice.show(o,e)},hideNotice:function(o){r.main.globalNotice.hide(o)},checkLogin:function(){},setToken:function(o){localStorage.setItem("token",o),s.su.url.stok=o},getToken:function(){var o=s.su.url.stok;return o||""},syncTokenFromStorage:function(){var o=localStorage.getItem("token");o&&(s.su.url.stok=o)},onLoginTimeout:function(){t.setToken(""),location.href="http://tplinkwifi.net"},onAutoUpgrading:function(){t.setToken(""),location.href="./auto_update_blocking.html"},loadLoginPage:function(){t.setToken(""),t.loadBasicModule("login")},onUserConflict:function(){},onPermissionDenied:function(){t.alert(s.su.CHAR.ERROR["00000088"])},reload:function(){location.href="/"},toggelVisibleMask:function(o){o?r.main.transparentMask.show("global-nontrans-mask"):r.main.transparentMask.hide("global-nontrans-mask")},showMask:function(){r.main.transparentMask.show("global-trans-mask")},hideMask:function(){r.main.transparentMask.hide("global-trans-mask")},confirm:function(o,e,n,a,i){o&&(r.main.globalConfirm.setContent(o),r.main.globalConfirm.show(),r.main.globalConfirm.setButtonText("ok",a||s.su.CHAR.OPERATION.YES_UPPERCASE),r.main.globalConfirm.setButtonText("no",i||s.su.CHAR.OPERATION.CANCEL_UPPERCASE),t.globalConfirmSuccessCallback=e||function(){},t.globalConfirmFailCallback=n||function(){})},alert:function(o){o&&(r.main.globalAlert.setContent(o),r.main.globalAlert.show())},getCloudInfo:function(){return t.cloudInfo},setWaitingEvent:function(o,e,n){t.waitingId=!1;var a=n||t.waitingTime;return e=(e=e||window).jquery?e:s(e),t.waitingId=setTimeout(function(){e.trigger(o)},a),!0},clearWaitingEvent:function(){t.waitingId&&(clearTimeout(t.waitingId),t.waitingId=!1)},showProBar:function(o,e){r.main.proBar.reset(),r.main.proBar.setText(o),e?(r.main.proBarTips.show(),r.main.proBarTips.setText(e)):r.main.proBarTips.hide(),r.main.progressbarWrap.show()},hideProBar:function(){r.main.progressbarWrap.hide()},setProBarValue:function(o,e){r.main.proBar.setValue(o,e)},setUpgradeRetryContent:function(o){r.main.failRetryMsg.setContent(o)},showUpgradeRetry:function(){r.main.failRetryMsg.show()},showUpgradeFailAlert:function(){r.main.upgradeFailAlert.show()}}})}(jQuery);